<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="it" xml:lang="it"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.34">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>48&nbsp; L’algoritmo di Metropolis-Hastings – Psicometria</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapters/mcmc/02_ppl.html" rel="next">
<link href="../../chapters/mcmc/introduction_mcmc.html" rel="prev">
<link href="../../style/gauss.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-0a72236910a44089af39cd28873f322e.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-9908c7b05874059c2106d454ac00f1d0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Nessun risultato",
    "search-matching-documents-text": "documenti trovati",
    "search-copy-link-title": "Copiare il link nella ricerca",
    "search-hide-matches-text": "Nascondere i risultati aggiuntivi",
    "search-more-match-text": "ci sono altri risultati in questo documento",
    "search-more-matches-text": "ulteriori risultati in questo documento",
    "search-clear-button-title": "Pulire",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancellare",
    "search-submit-button-title": "Inviare",
    "search-label": "Ricerca"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-QT5S3P9D31"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-QT5S3P9D31', { 'anonymize_ip': true});
</script><style>html{ scroll-behavior: smooth; }</style>
<script>
window.MathJax = {
  tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
  svg: { scale: 1, mtextInheritFont: true, fontCache: 'none', minScale: 1 },
  options: { renderActions: { addMenu: [0, '', ''] } },
  loader: { load: ['input/tex','output/svg'] }
};
</script><script>
window.MathJax = {
  tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
  svg: { scale: 1, mtextInheritFont: true, fontCache: 'none', minScale: 1 },
  options: { renderActions: { addMenu: [0, '', ''] } },
  loader: { load: ['input/tex','output/svg'] }
};
// Suggerimento CSS: vedi sezione 3 per gli spazi attorno a display math
</script><script>
window.MathJax = {
  tex: {
    packages: {'[+]': ['boldsymbol']},
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  },
  svg: { fontCache: 'global' }
};
</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="../../style/_typography-extras.css">
<link rel="stylesheet" href="../../style/_code-extras.css">
<link rel="stylesheet" href="../../style/_math-extras.css">
<link rel="stylesheet" href="../../style/styles.css">
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Attiva/disattiva la barra laterale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/mcmc/introduction_mcmc.html">MCMC</a></li><li class="breadcrumb-item"><a href="../../chapters/mcmc/01_metropolis.html"><span class="chapter-number">48</span>&nbsp; <span class="chapter-title">L’algoritmo di Metropolis-Hastings</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Attiva/disattiva la barra laterale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Ricerca" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Psicometria</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/ccaudek/psicometria-r/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Attiva/disattiva la modalità lettore">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Ricerca"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Informazioni generali</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../prefazione.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduzione</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/key_notions/introduction_key_notions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fondamenti</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Attiva/disattiva sezione">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/key_notions/01_data_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">La crisi di replicazione e la riforma metodologica in psicologia</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/key_notions/02_key_notions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Concetti chiave</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/key_notions/03_design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Campionamento, metodologia sperimentale e studi osservazionali</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/key_notions/04_measurement.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">La misurazione in psicologia</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/key_notions/05_cognitive_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Dalla descrizione alla spiegazione</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/R/introduction_r_lang.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Attiva/disattiva sezione">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/R/01_r_syntax.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Un approccio moderno all’analisi dei dati</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/R/02_utility_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Utility functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/R/03_r_programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Programmazione</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/R/04_r_packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Pacchetti</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/R/05_dplyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Usare <code>dplyr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/R/06_quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Quarto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/R/07_environment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">L’ambiente di programmazione</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/eda/introduction_eda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">EDA</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Attiva/disattiva sezione">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/eda/01_project_structure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Il ciclo di vita di un progetto di analisi dei dati</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/eda/02_data_cleaning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Flusso di lavoro per la pulizia dei dati</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/eda/03_exploring_qualitative_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Esplorare i dati qualitativi</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/eda/04_exploring_numeric_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Esplorare i dati numerici</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/eda/05_data_visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Principi della visualizzazione dei dati</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/eda/06_loc_scale.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Indicatori di tendenza centrale e variabilità</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/eda/07_introduction_normal_distribution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Introduzione alla distribuzione normale</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/eda/08_correlation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Relazioni tra variabili</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/eda/09_causality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Causalità dai dati osservazionali</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/eda/10_outlier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Outlier</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../chapters/probability/introduction_probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilità</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Attiva/disattiva sezione">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/probability/01_intro_prob.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Interpretazione della probabilità</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/probability/02_probability_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Modelli probabilistici</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/probability/03_sigma-algebra.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Dal Discreto al Continuo: la <span class="math inline">\(\sigma\)</span>-algebra</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/probability/04_conditional_prob.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Probabilità condizionata</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/probability/05_bayes_theorem.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Il teorema di Bayes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/probability/06_random_var.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Variabili casuali</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/probability/07_prob_distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Distribuzioni di massa e di densità</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/probability/08_expval_var.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Proprietà delle variabili casuali</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/probability/09_sampling_distr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Stime, stimatori e parametri</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/probability/10_joint_prob.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Probabilità congiunta</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/probability/11_cov_cor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Covarianza e correlazione</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/probability/12_intro_distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Introduzione alle distribuzioni di probabilità</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/probability/13_discr_rv_distr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Distribuzioni di v.c. discrete</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/probability/14_cont_rv_distr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Distribuzioni di v.c. continue</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/probability/15_gauss.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Assunzione di gaussianità e trasformazioni dei dati</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/probability/16_likelihood.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">La verosimiglianza</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Inferenza</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Attiva/disattiva sezione">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/bayesian_inference/introduction_bayes_inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduzione</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/bayesian_inference/01_uncertainty.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Abbracciare l’incertezza</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/bayesian_inference/02_intro_bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">La quantificazione dell’incertezza</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/bayesian_inference/03_statistical_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Modelli statistici</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/bayesian_inference/04_subj_prop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">Aggiornare le credenze su un parametro: dal prior alla posterior</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/bayesian_inference/05_conjugate_families.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">43</span>&nbsp; <span class="chapter-title">Distribuzioni coniugate</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/bayesian_inference/06_summary_posterior.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">44</span>&nbsp; <span class="chapter-title">Sintesi a posteriori</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/bayesian_inference/07_balance_prior_post.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">45</span>&nbsp; <span class="chapter-title">L’influenza della distribuzione a priori</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/bayesian_inference/08_prior_pred_check.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">46</span>&nbsp; <span class="chapter-title">Controllo predittivo a priori</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/bayesian_inference/09_post_pred_distr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">47</span>&nbsp; <span class="chapter-title">Distribuzione predittiva a posteriori</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">MCMC</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Attiva/disattiva sezione">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/mcmc/introduction_mcmc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduzione</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/mcmc/01_metropolis.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">48</span>&nbsp; <span class="chapter-title">L’algoritmo di Metropolis-Hastings</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/mcmc/02_ppl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">49</span>&nbsp; <span class="chapter-title">Linguaggi di programmazione probabilistici</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/mcmc/03_stan_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">50</span>&nbsp; <span class="chapter-title">Introduzione pratica a Stan</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/mcmc/04_stan_diagnostics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">51</span>&nbsp; <span class="chapter-title">Diagnostica delle catene markoviane</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/mcmc/05_mcmc_prediction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">52</span>&nbsp; <span class="chapter-title">Controlli predittivi bayesiani (a priori e a posteriori) con <code>cmdstanr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/mcmc/06_stan_odds_ratio_stan.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">53</span>&nbsp; <span class="chapter-title">Analisi bayesiana dell’odds ratio</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/mcmc/07_stan_poisson_model_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">54</span>&nbsp; <span class="chapter-title">Modello di Poisson</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/mcmc/08_stan_gaussian_mixture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">55</span>&nbsp; <span class="chapter-title">Modelli Mistura Gaussiani</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/mcmc/09_stan_nuisance_parameters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">56</span>&nbsp; <span class="chapter-title">Modelli con più di un parametro</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/mcmc/10_stan_hier_beta_binom.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">57</span>&nbsp; <span class="chapter-title">Modello gerarchico beta-binomiale</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/mcmc/11_bayesian_workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">58</span>&nbsp; <span class="chapter-title">Flusso di lavoro bayesiano</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false">
 <span class="menu-text">Regressione</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false" aria-label="Attiva/disattiva sezione">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/linear_models/introduction_linear_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduzione</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/linear_models/01_reglin_frequentist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">59</span>&nbsp; <span class="chapter-title">La regressione lineare bivariata</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/linear_models/02_regr_toward_mean.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">60</span>&nbsp; <span class="chapter-title">La regressione verso la media</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/linear_models/03_reglin_bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">61</span>&nbsp; <span class="chapter-title">Modello bayesiano di regressione lineare bivariata</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/linear_models/04_synt_sugar_sea_ice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">62</span>&nbsp; <span class="chapter-title">Zucchero sintattico</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/linear_models/05_stan_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">63</span>&nbsp; <span class="chapter-title">Regressione lineare in Stan</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/linear_models/06_specification_error.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">64</span>&nbsp; <span class="chapter-title">Errore di specificazione e bias da variabile omessa</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/linear_models/07_one_mean.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">65</span>&nbsp; <span class="chapter-title">Inferenza bayesiana su una media</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/linear_models/08_two_means.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">66</span>&nbsp; <span class="chapter-title">Confronto tra le medie di due gruppi</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/linear_models/09_effect_size.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">67</span>&nbsp; <span class="chapter-title">La grandezza dell’effetto: valutare la rilevanza pratica</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/linear_models/10_sample_size.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">68</span>&nbsp; <span class="chapter-title">Pianificazione della dimensione campionaria</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/linear_models/11_anova_1via.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">69</span>&nbsp; <span class="chapter-title">ANOVA ad una via</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="false">
 <span class="menu-text">GLM</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="false" aria-label="Attiva/disattiva sezione">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/glm/introduction_glm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduzione</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/glm/01_logistic_regr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">70</span>&nbsp; <span class="chapter-title">Regressione logistica con Stan</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/glm/02_one_proportion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">71</span>&nbsp; <span class="chapter-title">Inferenza sulle proporzioni</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/glm/03_two_proportions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">72</span>&nbsp; <span class="chapter-title">Confronto tra due proporzioni con la regressione logistica</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/glm/04_poisson_model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">73</span>&nbsp; <span class="chapter-title">Modello di Poisson</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/glm/05_logistic_process.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">74</span>&nbsp; <span class="chapter-title">Dal GLM a un modello processuale per dati binari</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="false">
 <span class="menu-text">Entropia</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="false" aria-label="Attiva/disattiva sezione">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/entropy/01_entropy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">75</span>&nbsp; <span class="chapter-title">Entropia e informazione di Shannon</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/entropy/02_kl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">76</span>&nbsp; <span class="chapter-title">La divergenza di Kullback-Leibler</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/entropy/03_model_comparison.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">77</span>&nbsp; <span class="chapter-title">Valutare i modelli bayesiani</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="false">
 <span class="menu-text">Modelli</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="false" aria-label="Attiva/disattiva sezione">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/formal_models/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">78</span>&nbsp; <span class="chapter-title">Teorie formali dei fenomeni psicologici</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/formal_models/01_dynamic_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">79</span>&nbsp; <span class="chapter-title">Il modello di revisione degli obiettivi</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/formal_models/02_dynamic_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">80</span>&nbsp; <span class="chapter-title">Estensioni</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/formal_models/03_rescorla_wagner.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">81</span>&nbsp; <span class="chapter-title">Il modello di Rescorla–Wagner</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="false">
 <span class="menu-text">Decisioni</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="false" aria-label="Attiva/disattiva sezione">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/decision_analysis/01_study_method.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">82</span>&nbsp; <span class="chapter-title">Decisione ottimale e utilità attesa: l’approccio bayesiano</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="false">
 <span class="menu-text">Missing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="false" aria-label="Attiva/disattiva sezione">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/missing/01_mnar_stan.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">83</span>&nbsp; <span class="chapter-title">Dati mancanti in psicologia</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" role="navigation" aria-expanded="false">
 <span class="menu-text">Frequentismo</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" role="navigation" aria-expanded="false" aria-label="Attiva/disattiva sezione">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-13" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/frequentist_inference/introduction_frequentist_inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduzione</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/frequentist_inference/01_galton.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">84</span>&nbsp; <span class="chapter-title">Inferenza frequentista</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/frequentist_inference/02_stime_parametri.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">85</span>&nbsp; <span class="chapter-title">Stime, stimatori e parametri</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/frequentist_inference/03_conf_interv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">86</span>&nbsp; <span class="chapter-title">Intervalli di fiducia</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/frequentist_inference/04_sample_size.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">87</span>&nbsp; <span class="chapter-title">La grandezza del campione</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/frequentist_inference/05_test_ipotesi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">88</span>&nbsp; <span class="chapter-title">Significatività statistica</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/frequentist_inference/06_two_ind_samples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">89</span>&nbsp; <span class="chapter-title">Test t di Student per campioni indipendenti</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-14" role="navigation" aria-expanded="false">
 <span class="menu-text">Crisi</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-14" role="navigation" aria-expanded="false" aria-label="Attiva/disattiva sezione">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-14" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/replication_crisis/introduction_replication_crisis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduzione</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/replication_crisis/01_crisis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">90</span>&nbsp; <span class="chapter-title">La crisi della replicazione</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/replication_crisis/02_limits_stat_freq.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">91</span>&nbsp; <span class="chapter-title">Limiti dell’inferenza frequentista</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/replication_crisis/03_effect_size.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">92</span>&nbsp; <span class="chapter-title">La grandezza dell’effetto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/replication_crisis/04_s_m_errors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">93</span>&nbsp; <span class="chapter-title">Errori di segno e errori di grandezza</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/replication_crisis/05_p_values.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">94</span>&nbsp; <span class="chapter-title">La fragilità del <em>p</em>-valore</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/replication_crisis/06_changes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">95</span>&nbsp; <span class="chapter-title">Riforma</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/replication_crisis/07_degrees_of_freedom.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">96</span>&nbsp; <span class="chapter-title">I gradi di libertà del ricercatore</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/replication_crisis/08_integrity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">97</span>&nbsp; <span class="chapter-title">Integrità della ricerca</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-15" role="navigation" aria-expanded="false">
 <span class="menu-text">Epilogo</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-15" role="navigation" aria-expanded="false" aria-label="Attiva/disattiva sezione">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-15" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/epiloque/epiloque.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Considerazioni Conclusive</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-16" role="navigation" aria-expanded="false">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-16" role="navigation" aria-expanded="false" aria-label="Attiva/disattiva sezione">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-16" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendix/a01_shell.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">La Shell</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendix/a01a_files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Cartelle e documenti</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendix/a02_math_symbols.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Simbologia di base</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendix/a03_latex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Equazioni Matematiche in LaTeX</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendix/a11_numbers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Numeri e intervalli</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendix/a12_sum_notation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Sommatorie</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendix/a13_sets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">G</span>&nbsp; <span class="chapter-title">Insiemi</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendix/a14_combinatorics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">H</span>&nbsp; <span class="chapter-title">Calcolo combinatorio</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendix/a15_calculus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">I</span>&nbsp; <span class="chapter-title">Per liberarvi dai terrori preliminari</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendix/a35_other_conjugate_families.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">J</span>&nbsp; <span class="chapter-title">Altre famiglie coniugate</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendix/a36_gamma_poisson_model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">K</span>&nbsp; <span class="chapter-title">Modello coniugato Gamma-Poisson</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendix/a41_cmdstanr_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">L</span>&nbsp; <span class="chapter-title">Implementazione di modelli Bayesiani con Stan tramite <code>cmdstanr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendix/a47_first_order_markov.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">M</span>&nbsp; <span class="chapter-title">Catene di Markov</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendix/a50_lin_fun.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">N</span>&nbsp; <span class="chapter-title">La funzione lineare</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendix/a71_install_cmdstan.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">O</span>&nbsp; <span class="chapter-title">Come installare CmdStan</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Sommario</h2>
   
  <ul class="collapse">
<li><a href="#lobiettivo-del-metodo-mcmc" id="toc-lobiettivo-del-metodo-mcmc" class="nav-link active" data-scroll-target="#lobiettivo-del-metodo-mcmc"><span class="header-section-number">48.1</span> L’obiettivo del metodo MCMC</a></li>
  <li><a href="#lalgoritmo-di-metropolis-introduzione-intuitiva" id="toc-lalgoritmo-di-metropolis-introduzione-intuitiva" class="nav-link" data-scroll-target="#lalgoritmo-di-metropolis-introduzione-intuitiva"><span class="header-section-number">48.2</span> L’algoritmo di Metropolis: introduzione intuitiva</a></li>
  <li><a href="#perch%C3%A9-accettiamo-anche-mosse-peggiori" id="toc-perché-accettiamo-anche-mosse-peggiori" class="nav-link" data-scroll-target="#perch%C3%A9-accettiamo-anche-mosse-peggiori"><span class="header-section-number">48.3</span> Perché accettiamo anche mosse peggiori</a></li>
  <li><a href="#la-scelta-della-larghezza-della-proposta" id="toc-la-scelta-della-larghezza-della-proposta" class="nav-link" data-scroll-target="#la-scelta-della-larghezza-della-proposta"><span class="header-section-number">48.4</span> La scelta della larghezza della proposta</a></li>
  <li><a href="#limportanza-dei-grafici-diagnostici-trace-plot-e-correlogramma" id="toc-limportanza-dei-grafici-diagnostici-trace-plot-e-correlogramma" class="nav-link" data-scroll-target="#limportanza-dei-grafici-diagnostici-trace-plot-e-correlogramma"><span class="header-section-number">48.5</span> L’importanza dei grafici diagnostici: Trace plot e Correlogramma</a></li>
  <li><a href="#un-esempio-concreto" id="toc-un-esempio-concreto" class="nav-link" data-scroll-target="#un-esempio-concreto"><span class="header-section-number">48.6</span> Un esempio concreto</a></li>
  <li><a href="#esempio-di-implementazione" id="toc-esempio-di-implementazione" class="nav-link" data-scroll-target="#esempio-di-implementazione"><span class="header-section-number">48.7</span> Esempio di implementazione</a></li>
  <li><a href="#catene-di-markov-e-convergenza" id="toc-catene-di-markov-e-convergenza" class="nav-link" data-scroll-target="#catene-di-markov-e-convergenza"><span class="header-section-number">48.8</span> Catene di Markov e convergenza</a></li>
  <li><a href="#diagnostiche-della-soluzione-mcmc" id="toc-diagnostiche-della-soluzione-mcmc" class="nav-link" data-scroll-target="#diagnostiche-della-soluzione-mcmc"><span class="header-section-number">48.9</span> Diagnostiche della soluzione MCMC</a></li>
  <li><a href="#vantaggi-del-campionamento-mcmc-rispetto-alle-soluzioni-analitiche" id="toc-vantaggi-del-campionamento-mcmc-rispetto-alle-soluzioni-analitiche" class="nav-link" data-scroll-target="#vantaggi-del-campionamento-mcmc-rispetto-alle-soluzioni-analitiche"><span class="header-section-number">48.10</span> Vantaggi del campionamento MCMC rispetto alle soluzioni analitiche</a></li>
  <li><a href="#caso-normale-normale-con-soluzione-analitica" id="toc-caso-normale-normale-con-soluzione-analitica" class="nav-link" data-scroll-target="#caso-normale-normale-con-soluzione-analitica"><span class="header-section-number">48.11</span> Caso Normale-Normale con soluzione analitica</a></li>
  </ul><div class="toc-actions"><ul class="collapse"><li><a href="https://github.com/ccaudek/psicometria-r/blob/main/chapters/mcmc/01_metropolis.qmd" class="toc-action"><i class="bi bi-github"></i>Mostra il codice</a></li><li><a href="https://github.com/ccaudek/psicometria-r/issues/new" class="toc-action"><i class="bi empty"></i>Segnala un problema</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/mcmc/introduction_mcmc.html">MCMC</a></li><li class="breadcrumb-item"><a href="../../chapters/mcmc/01_metropolis.html"><span class="chapter-number">48</span>&nbsp; <span class="chapter-title">L’algoritmo di Metropolis-Hastings</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-mcmc-metropolis" class="quarto-section-identifier"><span class="chapter-number">48</span>&nbsp; <span class="chapter-title">L’algoritmo di Metropolis-Hastings</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="introduzione" class="level2 unnumbered unlisted"><h2 class="unnumbered unlisted anchored" data-anchor-id="introduzione">Introduzione</h2>
<p>Nei capitoli precedenti abbiamo visto che l’inferenza bayesiana può essere risolta esattamente in alcuni casi fortunati, grazie alle famiglie coniugate, oppure approssimata con metodi semplici come l’uso di una griglia di valori. Questi strumenti ci hanno permesso di comprendere a fondo la logica dell’aggiornamento bayesiano, ma hanno anche mostrato chiaramente i loro limiti: i casi coniugati sono eccezioni, e l’approccio su griglia diventa rapidamente impraticabile quando il numero di parametri cresce oltre uno o due. Per affrontare problemi realistici, che in psicologia riguardano quasi sempre modelli con più parametri e strutture complesse, dobbiamo introdurre un metodo generale che ci consenta di ottenere campioni dalla distribuzione a posteriori senza doverla calcolare in forma chiusa. Questo metodo esiste, ed è noto come algoritmo di Metropolis <span class="citation" data-cites="metropolist_etal_1953 hastings_1970">(<a href="#ref-hastings_1970" role="doc-biblioref">Hastings, 1970</a>; <a href="#ref-metropolist_etal_1953" role="doc-biblioref">Metropolis et al., 1953</a>)</span>.</p>
<p>L’algoritmo di Metropolis rappresenta una svolta concettuale: offre una soluzione universale per generare campioni dalla distribuzione a posteriori, indipendentemente dalla forma della verosimiglianza e del prior. In questo senso, risolve in modo definitivo il problema di come rendere praticabile l’inferenza bayesiana. Tuttavia, presenta anche due limiti: è relativamente inefficiente dal punto di vista computazionale e richiede di scrivere codice su misura per ogni modello. Nonostante ciò, la sua logica è così generale e potente che costituisce la base di tutti gli algoritmi moderni di campionamento, incluso il metodo NUTS implementato in Stan.</p>
<p>In questo capitolo introdurremo passo dopo passo l’algoritmo di Metropolis, ne vedremo il funzionamento intuitivo e lo applicheremo a casi concreti. Questo ci permetterà di capire la logica alla base di gran parte dell’inferenza bayesiana moderna, che rimane immutata anche nei metodi più sofisticati.</p>
<section id="panoramica-del-capitolo" class="level3 unnumbered unlisted"><h3 class="unnumbered unlisted anchored" data-anchor-id="panoramica-del-capitolo">Panoramica del capitolo</h3>
<ul>
<li>Utilizzare metodi Monte Carlo per stimare valori attesi e probabilità, evitando calcoli integrali complessi.</li>
<li>Comprendere il ruolo delle catene di Markov nel campionamento dalla distribuzione a posteriori.</li>
<li>Implementare l’algoritmo di Metropolis per il campionamento a posteriori.</li>
<li>Valutare la convergenza delle catene con strumenti diagnostici come trace plot e autocorrelazione.</li>
<li>Gestire la fase di burn-in e utilizzare più catene per garantire stazionarietà e ridurre l’autocorrelazione.</li>
</ul>
<div class="callout callout-style-simple callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prerequisiti
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>Leggere l’<a href="../appendix/a15_calculus.html" class="quarto-xref"><span>Appendice I</span></a>.</li>
</ul>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-caution no-icon callout-titled" title="Preparazione del Notebook">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Preparazione del Notebook
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html">here</a></span><span class="op">(</span><span class="st">"code"</span>, <span class="st">"_common.R"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load packages</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"pacman"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"pacman"</span><span class="op">)</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">cmdstanr</span>, <span class="va">reshape2</span><span class="op">)</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section></section><section id="lobiettivo-del-metodo-mcmc" class="level2" data-number="48.1"><h2 data-number="48.1" class="anchored" data-anchor-id="lobiettivo-del-metodo-mcmc">
<span class="header-section-number">48.1</span> L’obiettivo del metodo MCMC</h2>
<p>Il metodo MCMC è un approccio computazionale che consente di approssimare distribuzioni di probabilità complesse, generando una sequenza di valori campionati che seguono la distribuzione a posteriori di interesse.</p>
<p>L’idea di base è la seguente:</p>
<ul>
<li>consideriamo la distribuzione a posteriori come una popolazione da cui desideriamo estrarre campioni;</li>
<li>generando un numero sufficientemente grande di campioni (ad esempio, diverse migliaia), la distribuzione empirica dei campioni ottenuti si avvicina progressivamente alla distribuzione teorica a posteriori;</li>
<li>in questo modo, possiamo stimare quantità di interesse, come la media, la varianza, o intervalli di credibilità, anche senza conoscere una forma analitica esplicita della distribuzione a posteriori.</li>
</ul>
<section id="la-natura-dipendente-del-campionamento-mcmc" class="level3" data-number="48.1.1"><h3 data-number="48.1.1" class="anchored" data-anchor-id="la-natura-dipendente-del-campionamento-mcmc">
<span class="header-section-number">48.1.1</span> La natura dipendente del campionamento MCMC</h3>
<p>A differenza delle tecniche di campionamento indipendente precedentemente esaminate, l’approccio MCMC genera una sequenza di valori correlati attraverso un meccanismo di transizione markoviana. La caratteristica distintiva di questo processo risiede nella proprietà di Markov: ogni nuovo campione dipende esclusivamente dallo stato corrente della catena, mostrando memoria soltanto a breve termine piuttosto che dipendenza dall’intera storia precedente.</p>
<p>Questa architettura sequenziale produce inevitabilmente autocorrelazione tra osservazioni adiacenti. Quando la catena visita una regione ad alta densità della distribuzione target, tenderà a persistere in tale zona per diverse iterazioni prima di migrare verso altre regioni. Mentre tale comportamento è funzionale all’esplorazione efficiente dello spazio parametrico, introduce importanti considerazioni pratiche:</p>
<ol type="1">
<li>l’informazione effettiva contenuta in <span class="math inline">\(N\)</span> campioni correlati è inferiore a quella di <span class="math inline">\(N\)</span> campioni indipendenti;</li>
<li>la valutazione della convergenza richiede analisi diagnostiche specifiche;</li>
<li>la dimensione efficace del campione (ESS) diventa un parametro cruciale per la qualità dell’inferenza.</li>
</ol>
<p>Per compensare questa riduzione di informazione per campione, è generalmente necessario generare sequenze più lunghe rispetto al campionamento indipendente. Tuttavia, questo svantaggio apparente è ampiamente compensato dalla capacità di MCMC di affrontare problemi complessi che risulterebbero intrattabili con metodi tradizionali.</p>
</section><section id="perché-utilizzare-mcmc" class="level3" data-number="48.1.2"><h3 data-number="48.1.2" class="anchored" data-anchor-id="perché-utilizzare-mcmc">
<span class="header-section-number">48.1.2</span> Perché utilizzare MCMC</h3>
<p>Il metodo MCMC è diventato uno strumento centrale nell’inferenza bayesiana contemporanea perché:</p>
<ul>
<li>è in grado di affrontare problemi complessi, caratterizzati da distribuzioni a posteriori di forma irregolare o definite in spazi ad alta dimensione;</li>
<li>non richiede il calcolo diretto dell’integrale di normalizzazione che compare nel teorema di Bayes;</li>
<li>permette di ottenere approssimazioni accurate della distribuzione a posteriori tramite simulazione numerica.</li>
</ul>
<p>Nel seguito ci concentreremo sull’<em>algoritmo di Metropolis</em>, uno dei metodi più semplici ed essenziali per implementare il campionamento MCMC.</p>
</section></section><section id="lalgoritmo-di-metropolis-introduzione-intuitiva" class="level2" data-number="48.2"><h2 data-number="48.2" class="anchored" data-anchor-id="lalgoritmo-di-metropolis-introduzione-intuitiva">
<span class="header-section-number">48.2</span> L’algoritmo di Metropolis: introduzione intuitiva</h2>
<p>L’algoritmo di Metropolis è un metodo MCMC che consente di esplorare una distribuzione di probabilità complessa costruendo una sequenza di campioni dipendenti tra loro.</p>
<p>La logica dell’algoritmo può essere riassunta nei seguenti passaggi fondamentali:</p>
<ol type="1">
<li>
<strong>Punto di partenza</strong>: si inizia da un valore iniziale <span class="math inline">\(\theta_0\)</span> scelto arbitrariamente.</li>
<li>
<strong>Proposta di un nuovo punto</strong>: si genera un nuovo valore candidato <span class="math inline">\(\theta^*\)</span> partendo da <span class="math inline">\(\theta_0\)</span>, utilizzando una distribuzione di proposta (ad esempio una distribuzione normale centrata su <span class="math inline">\(\theta_0\)</span>).</li>
<li>
<strong>Valutazione della proposta</strong>: si confrontano le densità a posteriori associate al valore attuale <span class="math inline">\(\theta_0\)</span> e al valore proposto <span class="math inline">\(\theta^*\)</span>.</li>
<li>
<strong>Decisione di accettazione</strong>:
<ul>
<li>se <span class="math inline">\(\theta^*\)</span> ha una densità a posteriori più alta di <span class="math inline">\(\theta_0\)</span>, viene accettato automaticamente;</li>
<li>se <span class="math inline">\(\theta^*\)</span> ha una densità a posteriori inferiore, viene accettato con una certa probabilità proporzionale al rapporto delle densità.</li>
</ul>
</li>
<li>
<strong>Registrazione</strong>: in ogni caso, si registra la posizione attuale (sia che si sia accettato un nuovo punto, sia che si sia rimasti fermi).</li>
</ol>
<p>Questo processo viene ripetuto per un numero elevato di iterazioni, generando una catena di campioni che, dopo un opportuno periodo iniziale (detto <em>burn-in</em>), approssima la distribuzione a posteriori.</p>
</section><section id="perché-accettiamo-anche-mosse-peggiori" class="level2" data-number="48.3"><h2 data-number="48.3" class="anchored" data-anchor-id="perché-accettiamo-anche-mosse-peggiori">
<span class="header-section-number">48.3</span> Perché accettiamo anche mosse peggiori</h2>
<p>Uno degli aspetti peculiari dell’algoritmo di Metropolis è la possibilità di <em>accettare anche proposte peggiori</em>, ossia punti <span class="math inline">\(\theta^*\)</span> associati a una densità a posteriori minore rispetto allo stato attuale.</p>
<p>Questa scelta ha una motivazione fondamentale:</p>
<ul>
<li>se accettassimo <em>solo</em> le mosse che migliorano la densità, l’algoritmo rischierebbe di <em>bloccarsi</em> in un massimo locale della distribuzione, senza esplorare altre aree che, pur avendo densità più bassa localmente, potrebbero condurre a regioni più interessanti globalmente;</li>
<li>accettare <em>occasionalmente</em> mosse peggiori consente all’algoritmo di <em>esplorare meglio</em> tutto lo spazio dei parametri, evitando di rimanere intrappolato in una singola area.</li>
</ul>
<p>In questo modo, la catena può attraversare regioni di bassa probabilità e raggiungere altre modalità della distribuzione, garantendo una copertura più completa dello spazio delle soluzioni plausibili.</p>
</section><section id="la-scelta-della-larghezza-della-proposta" class="level2" data-number="48.4"><h2 data-number="48.4" class="anchored" data-anchor-id="la-scelta-della-larghezza-della-proposta">
<span class="header-section-number">48.4</span> La scelta della larghezza della proposta</h2>
<p>Nell’algoritmo di Metropolis, la proposta di un nuovo valore <span class="math inline">\(\theta^*\)</span> viene solitamente generata a partire dallo stato corrente <span class="math inline">\(\theta_t\)</span> utilizzando una <em>distribuzione di proposta simmetrica</em>, ad esempio una distribuzione normale <span class="math inline">\(\mathcal{N}(\theta_t, \tau^2)\)</span>, dove <span class="math inline">\(\tau\)</span> rappresenta la deviazione standard della proposta.</p>
<p>La scelta del valore di <span class="math inline">\(\tau\)</span> (ovvero della <em>larghezza della proposta</em>) è cruciale per il buon funzionamento dell’algoritmo:</p>
<ul>
<li>se <span class="math inline">\(\tau\)</span> è <em>troppo piccolo</em>, i passi proposti saranno molto vicini al punto attuale. In questo caso, molte proposte saranno accettate, ma la catena si muoverà lentamente nello spazio dei parametri, esplorandolo inefficientemente (alta correlazione tra i campioni);</li>
<li>se <span class="math inline">\(\tau\)</span> è <em>troppo grande</em>, i passi proposti saranno molto lontani dal punto attuale. In questo caso, la maggior parte delle proposte cadrà in regioni di bassa densità, portando a un alto tasso di rifiuto delle proposte e quindi a una scarsa efficienza del campionamento.</li>
</ul>
<p>Un valore ottimale di <span class="math inline">\(\tau\)</span> deve bilanciare:</p>
<ul>
<li>
<em>accettazione</em> sufficiente di nuove proposte;</li>
<li>
<em>esplorazione</em> efficiente dello spazio dei parametri.</li>
</ul>
<p>In generale, si cerca di ottenere un <em>tasso di accettazione</em> compreso tra il 40% e il 50% per l’algoritmo di Metropolis a singolo parametro.</p>
</section><section id="limportanza-dei-grafici-diagnostici-trace-plot-e-correlogramma" class="level2" data-number="48.5"><h2 data-number="48.5" class="anchored" data-anchor-id="limportanza-dei-grafici-diagnostici-trace-plot-e-correlogramma">
<span class="header-section-number">48.5</span> L’importanza dei grafici diagnostici: Trace plot e Correlogramma</h2>
<p>Per valutare la qualità della catena generata dall’algoritmo di Metropolis, è fondamentale analizzare alcuni <em>grafici diagnostici</em>.</p>
<section id="trace-plot" class="level3" data-number="48.5.1"><h3 data-number="48.5.1" class="anchored" data-anchor-id="trace-plot">
<span class="header-section-number">48.5.1</span> Trace plot</h3>
<p>Il <em>trace plot</em> rappresenta i valori campionati di <span class="math inline">\(\theta\)</span> in funzione del numero di iterazioni.</p>
<p>Un trace plot di buona qualità mostra:</p>
<ul>
<li>oscillazioni attorno a un valore centrale stabile (assenza di trend sistematici);</li>
<li>una copertura adeguata dello spazio plausibile per <span class="math inline">\(\theta\)</span>.</li>
</ul>
<p>Un trace plot problematico può rivelare:</p>
<ul>
<li>fasi iniziali instabili (burn-in non sufficientemente lungo);</li>
<li>mancata esplorazione completa della distribuzione;</li>
<li>convergenza solo apparente, con la catena bloccata in una modalità.</li>
</ul></section><section id="correlogramma" class="level3" data-number="48.5.2"><h3 data-number="48.5.2" class="anchored" data-anchor-id="correlogramma">
<span class="header-section-number">48.5.2</span> Correlogramma</h3>
<p>Il <em>correlogramma</em> mostra il grado di autocorrelazione dei campioni in funzione del numero di passi di lag.</p>
<p>Idealmente:</p>
<ul>
<li>l’autocorrelazione dovrebbe decrescere rapidamente all’aumentare del lag;</li>
<li>una catena ben mescolata presenta un correlogramma che si avvicina rapidamente a zero.</li>
</ul>
<p>Una forte autocorrelazione indica che i campioni successivi sono troppo simili tra loro, riducendo l’efficienza dell’inferenza statistica.</p>
<p>Questi concetti costituiscono il fondamento necessario per affrontare la comprensione operativa e pratica dell’algoritmo di Metropolis che svilupperemo nei prossimi esempi. A questo fine, il capitolo è strutturato in varie sezioni che facilitano la comprensione progressiva del tema.</p>
<ul>
<li>Inizieremo discutendo di come la distribuzione a posteriori possa essere approssimata mediante tecniche di simulazione convenzionali. Questa prima parte presuppone che la distribuzione target, o “a posteriori,” sia già conosciuta o disponibile per l’analisi.</li>
<li>In seguito, passeremo a illustrare come l’algoritmo di Metropolis possa essere utilizzato per affrontare situazioni in cui la distribuzione a posteriori non è direttamente nota. In questi casi, spesso abbiamo a disposizione informazioni riguardanti la distribuzione a priori e la funzione di verosimiglianza, che possono essere utilizzate per ottenere un’approssimazione efficace della distribuzione a posteriori.</li>
</ul></section></section><section id="un-esempio-concreto" class="level2" data-number="48.6"><h2 data-number="48.6" class="anchored" data-anchor-id="un-esempio-concreto">
<span class="header-section-number">48.6</span> Un esempio concreto</h2>
<p>A titolo esemplificativo, utilizzeremo il dataset <code>moma_sample.csv</code>, il quale costituisce un campione casuale di 100 artisti provenienti dal Museo di Arte Moderna di New York (MoMA) e contiene diverse informazioni relative a ciascun artista. Il nostro interesse è focalizzato sulla determinazione della probabilità che un artista presente nel MoMA appartenga alla generazione X o a una generazione successiva (nati dopo il 1965). Questa probabilità sarà indicata come <span class="math inline">\(\pi\)</span>.</p>
<p>Importiamo i dati.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">moma_sample</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="http://gesistsa.github.io/rio/reference/import.html">import</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"moma_sample.csv"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Esaminiamo le prime cinque righe del DataFrame.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">moma_sample</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                artist  country birth death alive  genx gender count</span></span>
<span><span class="co">#&gt; 1        Ad Gerritsen    dutch  1940  2015 FALSE FALSE   male     1</span></span>
<span><span class="co">#&gt; 2 Kirstine Roepstorff   danish  1972    NA  TRUE  TRUE female     3</span></span>
<span><span class="co">#&gt; 3    Lisa Baumgardner american  1958  2015 FALSE FALSE female     2</span></span>
<span><span class="co">#&gt; 4         David Bates american  1952    NA  TRUE FALSE   male     1</span></span>
<span><span class="co">#&gt; 5          Simon Levy american  1946    NA  TRUE FALSE   male     1</span></span>
<span><span class="co">#&gt; 6      Pierre Mercure canadian  1927  1966 FALSE FALSE   male     8</span></span>
<span><span class="co">#&gt;   year_acquired_min year_acquired_max</span></span>
<span><span class="co">#&gt; 1              1981              1981</span></span>
<span><span class="co">#&gt; 2              2005              2005</span></span>
<span><span class="co">#&gt; 3              2016              2016</span></span>
<span><span class="co">#&gt; 4              2001              2001</span></span>
<span><span class="co">#&gt; 5              2012              2012</span></span>
<span><span class="co">#&gt; 6              2008              2008</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dai dati osserviamo che solo 14 artisti su 100 appartengono alla generazione X o a una generazione successiva.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calcoliamo la distribuzione delle generazioni</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">moma_sample</span><span class="op">$</span><span class="va">genx</span><span class="op">)</span></span>
<span><span class="va">result</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; FALSE  TRUE </span></span>
<span><span class="co">#&gt;    86    14</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Il valore campionato <span class="math inline">\(y = 14\)</span> riflette le caratteristiche del campione che è stato osservato. Tuttavia, poiché il MOMA contiene opere di migliaia di artisti, sorge una domanda riguardante il vero valore di <span class="math inline">\(\theta\)</span> (la probabilità di appartenere alla generazione X o a una generazione successiva) all’interno di questa popolazione.</p>
<p>Possiamo interpretare i dati <span class="math inline">\(y = 14\)</span> come l’esito di una variabile casuale Binomiale con parametri <span class="math inline">\(N = 100\)</span> e <span class="math inline">\(\theta\)</span> sconosciuto.</p>
<p>Supponiamo che le nostre credenze pregresse riguardo a <span class="math inline">\(\theta\)</span> possano essere modellate attraverso una distribuzione Beta(4, 6).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">.01</span><span class="op">)</span>,</span>
<span>       y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">dbeta</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="01_metropolis_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:85.0%"></p>
</figure>
</div>
</div>
</div>
<p>Sfruttando le proprietà delle distribuzioni coniugate, possiamo calcolare esattamente la distribuzione a posteriori:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Y ~ Binomiale(100, π)</span></span>
<span><span class="co"># θ ~ Beta(4, 6)</span></span>
<span><span class="co"># Posteriori: θ | (Y = 14) ~ Beta(4 + 14, 6 + 100 - 14) → Beta(18, 92)</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Nella figura seguente, è rappresentata la distribuzione a posteriori del parametro <span class="math inline">\(\theta\)</span>, insieme alla distribuzione a priori specificata.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Sequenza per θ</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Densità prior e posterior</span></span>
<span><span class="va">prior_density</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">dbeta</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">posterior_density</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">dbeta</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">18</span>, <span class="fl">92</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Dati per il grafico</span></span>
<span><span class="va">df_long</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">x</span>,</span>
<span>  `Prior: Beta(4, 6)` <span class="op">=</span> <span class="va">prior_density</span>,</span>
<span>  `Posterior: Beta(18, 92)` <span class="op">=</span> <span class="va">posterior_density</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="op">-</span><span class="va">x</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"distribuzione"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"densita"</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    distribuzione <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span></span>
<span>      <span class="va">distribuzione</span>,</span>
<span>      levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Prior: Beta(4, 6)"</span>, <span class="st">"Posterior: Beta(18, 92)"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Palette di colori alternativa</span></span>
<span><span class="va">colori_custom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"Prior: Beta(4, 6)"</span> <span class="op">=</span> <span class="st">"#1F77B4"</span>,       <span class="co"># Blu</span></span>
<span>  <span class="st">"Posterior: Beta(18, 92)"</span> <span class="op">=</span> <span class="st">"#FF7F0E"</span>  <span class="co"># Arancione</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Creazione del grafico</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">df_long</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">densita</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_area</span><span class="op">(</span></span>
<span>    <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">distribuzione</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.30</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>    color <span class="op">=</span> <span class="cn">NA</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">distribuzione</span><span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1.1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Distribuzione"</span>,</span>
<span>    values <span class="op">=</span> <span class="va">colori_custom</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Distribuzione"</span>,</span>
<span>    values <span class="op">=</span> <span class="va">colori_custom</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span></span>
<span>    fill <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="cn">NA</span>, alpha <span class="op">=</span> <span class="fl">0.30</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span>, linewidth <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Densità"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    legend.box <span class="op">=</span> <span class="st">"horizontal"</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="01_metropolis_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:85.0%"></p>
</figure>
</div>
</div>
</div>
<p>In questo grafico, la curva blu rappresenta la distribuzione a priori <span class="math inline">\(\text{Beta}(4, 6)\)</span>, mentre la curva rossa mostra la distribuzione a posteriori <span class="math inline">\(\text{Beta}(18, 92)\)</span>. La sovrapposizione delle aree evidenzia come l’evidenza fornita dai dati modifichi la conoscenza iniziale sul parametro <span class="math inline">\(\theta\)</span>.</p>
<p>Se vogliamo conoscere il valore della media a posteriori di <span class="math inline">\(\theta\)</span>, il risultato esatto è</p>
<p><span class="math display">\[
\bar{\theta}_{post} = \frac{\alpha}{\alpha + \beta} = \frac{18}{18 + 92} \approx 0.1636.
\]</span></p>
<section id="simulazione-con-distribuzione-target-nota" class="level3" data-number="48.6.1"><h3 data-number="48.6.1" class="anchored" data-anchor-id="simulazione-con-distribuzione-target-nota">
<span class="header-section-number">48.6.1</span> Simulazione con distribuzione target nota</h3>
<p>Usiamo ora una simulazione numerica per stimare la media a posteriori di <span class="math inline">\(\theta\)</span>. Conoscendo la forma della distribuzione a posteriori <span class="math inline">\(Beta(18, 92)\)</span>, possiamo generare un campione di osservazioni casuali da questa distribuzione. Successivamente, calcoliamo la media delle osservazioni ottenute per ottenere un’approssimazione della media a posteriori.</p>
<p>Se vogliamo ottenere un risultato approssimato con un numero limitato di campioni (ad esempio, 10), possiamo utilizzare la seguente simulazione:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Generiamo 10 campioni dalla distribuzione Beta(18, 92)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>  <span class="co"># Per riproducibilità</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">rbeta</a></span><span class="op">(</span><span class="fl">10</span>, shape1 <span class="op">=</span> <span class="fl">18</span>, shape2 <span class="op">=</span> <span class="fl">92</span><span class="op">)</span></span>
<span><span class="va">y</span></span>
<span><span class="co">#&gt;  [1] 0.1183 0.1751 0.2147 0.0769 0.1817 0.1852 0.1416 0.1426 0.1419 0.1299</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calcoliamo la media dei campioni</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.151</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Tuttavia, con soli 10 campioni, l’approssimazione potrebbe non essere molto accurata. Aumentando il numero di campioni, ad esempio a 10,000, possiamo ottenere una stima molto più precisa:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Generiamo 10000 campioni e calcoliamo la media</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>  <span class="co"># Per riproducibilità</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">rbeta</a></span><span class="op">(</span><span class="fl">10000</span>, shape1 <span class="op">=</span> <span class="fl">18</span>, shape2 <span class="op">=</span> <span class="fl">92</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.164</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Quando il numero di campioni dalla distribuzione a posteriori diventa molto grande, la media campionaria <em>converge</em> al valore atteso della distribuzione della popolazione. Questo principio non si applica solo alla media, ma anche ad altre statistiche descrittive come la moda e la varianza.</p>
<p>È importante sottolineare che l’applicazione della simulazione di Monte Carlo è efficace per calcolare distribuzioni a posteriori <em>solo quando conosciamo la distribuzione</em> stessa e possiamo utilizzare funzioni R per estrarre campioni casuali da tale distribuzione. Ciò è stato possibile nel caso della distribuzione a posteriori <span class="math inline">\(Beta(18, 92)\)</span>. Tuttavia, questa situazione ideale non si verifica sempre nella pratica, poiché le distribuzioni a priori coniugate alla verosimiglianza sono spesso rare. Per esempio, nel caso di una verosimiglianza binomiale e una distribuzione a priori gaussiana, l’espressione</p>
<p><span class="math display">\[
p(\theta \mid y) = \frac{\mathrm{e}^{-(\theta - 1 / 2)^2} \theta^y (1 - \theta)^{n - y}} {\int_0^1 \mathrm{e}^{-(t - 1 / 2)^2} t^y (1 - t)^{n - y} dt}
\]</span></p>
<p>rende impossibile calcolare analiticamente la distribuzione a posteriori di <span class="math inline">\(\theta\)</span>, precludendo quindi l’utilizzo diretto di R per generare campioni casuali.</p>
<p>In queste circostanze, però, è possibile ottenere campioni casuali dalla distribuzione a posteriori mediante l’uso di metodi Monte Carlo basati su Catena di Markov (MCMC). Gli algoritmi MCMC, come ad esempio l’algoritmo Metropolis, costituiscono una classe di metodi che consentono di estrarre campioni casuali dalla distribuzione a posteriori <em>senza richiedere la conoscenza della sua rappresentazione analitica</em>. Le tecniche MCMC sono ampiamente adottate per risolvere problemi di inferenza bayesiana e rappresentano il principale strumento computazionale per ottenere stime approssimate di distribuzioni a posteriori in situazioni complesse e non analiticamente trattabili.</p>
</section><section id="algoritmo-di-metropolis" class="level3" data-number="48.6.2"><h3 data-number="48.6.2" class="anchored" data-anchor-id="algoritmo-di-metropolis">
<span class="header-section-number">48.6.2</span> Algoritmo di Metropolis</h3>
<p>L’algoritmo di Metropolis appartiene alla famiglia dei metodi Monte Carlo basati su catene di Markov (MCMC), sfruttando le proprietà di queste catene per generare campioni da una distribuzione target. Il suo obiettivo principale è di esplorare lo spazio dei parametri in modo efficiente, producendo campioni che approssimano la distribuzione a posteriori di interesse.</p>
</section><section id="principio-di-funzionamento" class="level3" data-number="48.6.3"><h3 data-number="48.6.3" class="anchored" data-anchor-id="principio-di-funzionamento">
<span class="header-section-number">48.6.3</span> Principio di funzionamento</h3>
<p>L’algoritmo inizia da un valore iniziale per i parametri e, in ogni iterazione, genera un nuovo campione tramite una distribuzione di proposta (solitamente una distribuzione normale centrata sul valore corrente). Successivamente, decide se accettare il nuovo campione in base al confronto tra le densità posteriori del nuovo campione e di quello precedente. Questa accettazione avviene in modo probabilistico, favorendo campioni con una densità più alta ma consentendo anche l’accettazione di campioni peggiori per evitare che la catena rimanga bloccata in minimi locali.</p>
</section><section id="burn-in-e-convergenza" class="level3" data-number="48.6.4"><h3 data-number="48.6.4" class="anchored" data-anchor-id="burn-in-e-convergenza">
<span class="header-section-number">48.6.4</span> Burn-in e convergenza</h3>
<p>Poiché i primi campioni potrebbero non rappresentare bene la distribuzione target, si esclude spesso una porzione iniziale della catena (fase di burn-in). Con il progredire delle iterazioni, i campioni si distribuiscono in accordo con la distribuzione stazionaria desiderata, indipendentemente dallo stato iniziale scelto. Questo processo permette di esplorare lo spazio dei parametri in modo efficiente.</p>
</section><section id="meccanismo-di-accettazione-e-rifiuto" class="level3" data-number="48.6.5"><h3 data-number="48.6.5" class="anchored" data-anchor-id="meccanismo-di-accettazione-e-rifiuto">
<span class="header-section-number">48.6.5</span> Meccanismo di accettazione e rifiuto</h3>
<p>L’algoritmo di Metropolis bilancia due esigenze opposte:</p>
<ol type="1">
<li>
<em>esplorazione</em> di nuove aree dello spazio dei parametri;</li>
<li>
<em>sfruttamento</em> delle informazioni già acquisite dai campioni precedenti.</li>
</ol>
<p>Utilizzando una regola probabilistica per accettare campioni peggiori (con minore densità a posteriori), l’algoritmo evita di restare intrappolato in minimi locali, esplorando così in modo più completo l’intera distribuzione.</p>
</section><section id="passaggi-fondamentali-dellalgoritmo-di-metropolis" class="level3" data-number="48.6.6"><h3 data-number="48.6.6" class="anchored" data-anchor-id="passaggi-fondamentali-dellalgoritmo-di-metropolis">
<span class="header-section-number">48.6.6</span> Passaggi fondamentali dell’algoritmo di Metropolis</h3>
<ol type="1">
<li>
<strong>Scelta di uno stato iniziale <span class="math inline">\(\theta_1\)</span> e impostazione del contatore <span class="math inline">\(t = 1\)</span>.</strong>
<ul>
<li>Questo è il punto di partenza della catena, dove <span class="math inline">\(\theta_1\)</span> rappresenta il primo campione.</li>
</ul>
</li>
<li>
<strong>Proposta di un nuovo campione <span class="math inline">\(\theta_p\)</span>.</strong>
<ul>
<li>Un nuovo valore <span class="math inline">\(\theta_p\)</span> viene generato da una distribuzione di proposta <span class="math inline">\(g(\theta_p \mid \theta_t)\)</span>, solitamente una distribuzione normale centrata sul campione corrente <span class="math inline">\(\theta_t\)</span> con una deviazione standard <span class="math inline">\(\tau\)</span> che controlla l’ampiezza dei passi.</li>
</ul>
</li>
<li>
<strong>Verifica dei vincoli del campione proposto.</strong>
<ul>
<li>Se il nuovo campione deve rispettare dei vincoli (ad esempio, essere compreso tra 0 e 1 per probabilità), campioni non validi vengono automaticamente rifiutati.</li>
</ul>
</li>
<li>
<strong>Calcolo del rapporto di accettazione <span class="math inline">\(\alpha\)</span>.</strong>
<ul>
<li>Si calcola <span class="math inline">\(\alpha = \frac{p(\theta_p \mid y)}{p(\theta_t \mid y)}\)</span>, che rappresenta il rapporto tra le densità a posteriori del nuovo campione <span class="math inline">\(\theta_p\)</span> e del campione corrente <span class="math inline">\(\theta_t\)</span>. Questo valore guida la decisione di accettazione.</li>
</ul>
</li>
<li>
<strong>Decisione di accettazione.</strong>
<ul>
<li>Se <span class="math inline">\(\alpha \geq 1\)</span>, il nuovo campione <span class="math inline">\(\theta_p\)</span> viene accettato incondizionatamente.</li>
<li>Se <span class="math inline">\(\alpha &lt; 1\)</span>, il campione <span class="math inline">\(\theta_p\)</span> viene accettato con probabilità <span class="math inline">\(\alpha\)</span>. In caso di rifiuto, si mantiene il campione corrente <span class="math inline">\(\theta_t\)</span> per la prossima iterazione.</li>
</ul>
</li>
<li>
<strong>Ripetizione del processo.</strong>
<ul>
<li>Si ripetono i passaggi dal 2 al 5 fino a ottenere il numero desiderato di campioni.</li>
</ul>
</li>
</ol></section><section id="dettagli-aggiuntivi" class="level3" data-number="48.6.7"><h3 data-number="48.6.7" class="anchored" data-anchor-id="dettagli-aggiuntivi">
<span class="header-section-number">48.6.7</span> Dettagli aggiuntivi</h3>
<ul>
<li>
<strong>Distribuzione di proposta</strong>: La distribuzione di proposta <span class="math inline">\(g(\theta_p \mid \theta_t)\)</span> genera nuovi campioni attorno a <span class="math inline">\(\theta_t\)</span>. Tipicamente si usa una normale <span class="math inline">\(N(\theta_t, \tau)\)</span>, dove <span class="math inline">\(\tau\)</span> controlla quanto il nuovo campione si discosta da quello corrente. Scegliere un <span class="math inline">\(\tau\)</span> troppo piccolo può rendere l’esplorazione lenta, mentre un <span class="math inline">\(\tau\)</span> troppo grande può far rifiutare troppi campioni, riducendo l’efficienza.</li>
<li>
<strong>Rapporto di accettazione <span class="math inline">\(\alpha\)</span></strong>: Se il nuovo campione ha una densità a posteriori maggiore del campione corrente, viene sempre accettato. Se ha una densità inferiore, viene accettato con probabilità <span class="math inline">\(\alpha\)</span>, il che consente di esplorare anche regioni meno probabili della distribuzione.</li>
<li>
<strong>Accettazione probabilistica</strong>: Accettare campioni peggiori occasionalmente aiuta l’algoritmo a evitare di bloccarsi in minimi locali. Questo è uno dei punti di forza dell’algoritmo di Metropolis, che garantisce una buona esplorazione dello spazio dei parametri.</li>
</ul></section></section><section id="esempio-di-implementazione" class="level2" data-number="48.7"><h2 data-number="48.7" class="anchored" data-anchor-id="esempio-di-implementazione">
<span class="header-section-number">48.7</span> Esempio di implementazione</h2>
<p>Supponiamo di voler stimare la probabilità <span class="math inline">\(\theta\)</span> che un artista della Generazione X sia esposto al MoMA. Disponiamo di 14 successi (presenze) osservati su un campione di 100 artisti. Adottiamo un modello binomiale con distribuzione a priori Beta(4, 6) per <span class="math inline">\(\theta\)</span>, integrando dati osservati e conoscenza a priori mediante l’algoritmo MCMC. Seguiremo l’impostazione metodologica proposta da <a href="https://elizaveta-semenova.com/">Elizaveta Semenova</a>, implementando l’algoritmo di Metropolis-Hastings in R. Cominciamo definendo alcune funzioni fondamentali.</p>
<section id="definizione-della-distribuzione-a-priori" class="level3" data-number="48.7.1"><h3 data-number="48.7.1" class="anchored" data-anchor-id="definizione-della-distribuzione-a-priori">
<span class="header-section-number">48.7.1</span> Definizione della distribuzione a priori</h3>
<p>La funzione <code>prior</code> calcola la densità della distribuzione Beta(4, 6) per un dato <span class="math inline">\(\theta\)</span>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Distribuzione a priori Beta(4, 6)</span></span>
<span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">dbeta</a></span><span class="op">(</span><span class="va">p</span>, shape1 <span class="op">=</span> <span class="fl">4</span>, shape2 <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Questa distribuzione esprime la nostra plausibilità iniziale sui valori di <span class="math inline">\(\theta\)</span> prima di osservare i dati.</p>
</section><section id="funzione-di-verosimiglianza" class="level3" data-number="48.7.2"><h3 data-number="48.7.2" class="anchored" data-anchor-id="funzione-di-verosimiglianza">
<span class="header-section-number">48.7.2</span> Funzione di verosimiglianza</h3>
<p>La funzione <code>likelihood</code> modella la probabilità di osservare 14 successi su 100 prove:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Verosimiglianza binomiale (y = 14 successi su n = 100 prove)</span></span>
<span><span class="va">likelihood</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">14</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">dbinom</a></span><span class="op">(</span><span class="va">y</span>, size <span class="op">=</span> <span class="va">n</span>, prob <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="distribuzione-a-posteriori-non-normalizzata" class="level3" data-number="48.7.3"><h3 data-number="48.7.3" class="anchored" data-anchor-id="distribuzione-a-posteriori-non-normalizzata">
<span class="header-section-number">48.7.3</span> Distribuzione a posteriori non normalizzata</h3>
<p>La posteriori si ottiene combinando priori e verosimiglianza:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Posteriori non normalizzata (prodotto tra verosimiglianza e priori)</span></span>
<span><span class="va">posterior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">likelihood</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="op">*</span> <span class="fu">prior</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="distribuzione-proposta" class="level3" data-number="48.7.4"><h3 data-number="48.7.4" class="anchored" data-anchor-id="distribuzione-proposta">
<span class="header-section-number">48.7.4</span> Distribuzione proposta</h3>
<p>La distribuzione proposta sarà una distribuzione normale centrata sullo stato corrente con una deviazione standard specificata:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Generazione proposta (normale con media sullo stato corrente)</span></span>
<span><span class="va">proposal_distribution</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">current_state</span>, <span class="va">proposal_sigma</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="va">current_state</span>, sd <span class="op">=</span> <span class="va">proposal_sigma</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="implementazione-dellalgoritmo-metropolis-hastings" class="level3" data-number="48.7.5"><h3 data-number="48.7.5" class="anchored" data-anchor-id="implementazione-dellalgoritmo-metropolis-hastings">
<span class="header-section-number">48.7.5</span> Implementazione dell’algoritmo Metropolis-Hastings</h3>
<p>Procediamo ora con l’implementazione dell’algoritmo di Metropolis-Hastings, considerando i dati relativi agli artisti della Generazione X presenti al MoMA. La distribuzione a priori per <span class="math inline">\(\theta\)</span> è modellata come una Beta(4, 6).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Algoritmo Metropolis-Hastings</span></span>
<span><span class="va">metropolis_hastings</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_samples</span>, <span class="va">start</span>, <span class="va">proposal_sigma</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="va">n_samples</span><span class="op">)</span></span>
<span>  <span class="va">current</span> <span class="op">&lt;-</span> <span class="va">start</span>  <span class="co"># Stato iniziale</span></span>
<span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">n_samples</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">proposal</span> <span class="op">&lt;-</span> <span class="fu">proposal_distribution</span><span class="op">(</span><span class="va">current</span>, <span class="va">proposal_sigma</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Verifica validità e calcolo rapporto di accettazione</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">proposal</span> <span class="op">&gt;=</span> <span class="fl">0</span> <span class="op">&amp;&amp;</span> <span class="va">proposal</span> <span class="op">&lt;=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">acceptance_ratio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu">posterior</span><span class="op">(</span><span class="va">proposal</span><span class="op">)</span> <span class="op">/</span> <span class="fu">posterior</span><span class="op">(</span><span class="va">current</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="co"># Accetta/rifiuta con probabilità acceptance_ratio</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">acceptance_ratio</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">current</span> <span class="op">&lt;-</span> <span class="va">proposal</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">samples</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">current</span>  <span class="co"># Aggiorna la catena</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-simple callout-tip no-icon callout-titled" title="Interpretazione intuitiva">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Interpretazione intuitiva
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Immaginate di esplorare un paesaggio montuoso (la posteriori) avvolto dalla nebbia, dove le alture rappresentano regioni ad alta densità di probabilità. L’algoritmo replica il comportamento di un escursionista che:</p>
<ol type="1">
<li>
<strong>Valuta la posizione corrente</strong> (<code>current</code>) tramite l’altezza locale (<code>posterior(current)</code>).</li>
<li>
<strong>Propone un passo casuale</strong> in una direzione vicina (<code>proposal</code>), determinata da una distribuzione normale.</li>
<li>
<strong>Decide il movimento</strong> confrontando le altezze relative:
<ul>
<li>Se il nuovo punto è più alto (<span class="math inline">\(R \geq 1\)</span>), lo accetta immediatamente.</li>
<li>Se è più basso (<span class="math inline">\(R &lt; 1\)</span>), lo accetta con probabilità <span class="math inline">\(R\)</span>, simulando un’<em>accettazione stocastica</em> per evitare massimi locali.</li>
</ul>
</li>
<li>
<strong>Registra ogni posizione</strong> visitata, costruendo gradualmente una mappa proporzionale alla vera distribuzione.</li>
</ol>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-tip no-icon callout-titled" title="Dettagli dell'implementazione (1)">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Dettagli dell’implementazione (1)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Nel codice la “regola &gt; 1 → accetta” è incorporata in queste <em>due istruzioni consecutive</em>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">acceptance_ratio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu">posterior</span><span class="op">(</span><span class="va">proposal</span><span class="op">)</span> <span class="op">/</span> <span class="fu">posterior</span><span class="op">(</span><span class="va">current</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">...</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">acceptance_ratio</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">current</span> <span class="op">&lt;-</span> <span class="va">proposal</span></span>
<span><span class="op">}</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol type="1">
<li>
<strong>Clipping a 1 con <code>min(1, …)</code></strong>
<ul>
<li>Se il rapporto <span class="math inline">\(\frac{\text{posterior(proposal)}}{\text{posterior(current)}}\)</span> è maggiore di 1 (cioè il nuovo punto ha densità a‐posteriori più alta), <code><a href="https://rdrr.io/r/base/Extremes.html">min()</a></code> lo tronca a 1.<br>
</li>
<li>Quindi <code>acceptance_ratio</code> vale esattamente 1 in tutti i casi in cui il “vero” rapporto sarebbe &gt; 1.</li>
</ul>
</li>
<li>
<strong>Accettazione certa con il confronto <code>runif(1) &lt; 1</code></strong>
<ul>
<li>
<code>runif(1)</code> genera un numero uniforme in <span class="math inline">\([0,1)\)</span>; qualunque valore estratto sarà sempre &lt; 1.<br>
</li>
<li>Di conseguenza, quando <code>acceptance_ratio</code> è 1 l’<code>if</code> è sempre vero e il punto proposto viene accettato con probabilità 1, esattamente come prescrive l’algoritmo di Metropolis (o di Metropolis-Hastings nel caso simmetrico).</li>
</ul>
</li>
</ol>
<p>In sintesi, la riga con <code>min(1, …)</code> <em>traduce</em> la regola teorica “accetta se il rapporto è &gt; 1” in una forma pratica che si integra con il test probabilistico successivo.</p>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-tip no-icon callout-titled" title="Dettagli dell'implementazione (2)">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Dettagli dell’implementazione (2)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Proprietà della proposta simmetrica</strong>: L’algoritmo di Metropolis (quello base come questo) funziona bene se la maniera in cui proponi di “spostarti” da un punto A a un punto B è esattamente la stessa della maniera in cui proporresti di spostarti da B ad A. Pensa a una proposta “neutra” rispetto alla direzione. Questa “simmetria” nella proposta è utile perché ci permette di decidere se accettare un passo basandoci esclusivamente sul confronto della ‘probabilità’ (la densità) dei due punti (proposto e attuale) sotto la distribuzione che vogliamo esplorare. In pratica, non dobbiamo preoccuparci di ‘correggere’ il rapporto di accettazione per tenere conto di proposte che potrebbero essere più facili in una direzione che nell’altra. Questa semplicità aiuta l’algoritmo a trovare il giusto bilanciamento negli spostamenti, permettendogli di campionare correttamente dalla distribuzione desiderata nel lungo periodo.</p>
</div>
</div>
</div>
</section><section id="esecuzione-dellalgoritmo" class="level3" data-number="48.7.6"><h3 data-number="48.7.6" class="anchored" data-anchor-id="esecuzione-dellalgoritmo">
<span class="header-section-number">48.7.6</span> Esecuzione dell’algoritmo</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Parametri dell'algoritmo</span></span>
<span><span class="va">n_samples</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="va">start</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">proposal_sigma</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span></span>
<span><span class="co"># Esecuzione del campionamento</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>  <span class="co"># Per riproducibilità</span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu">metropolis_hastings</span><span class="op">(</span><span class="va">n_samples</span>, <span class="va">start</span>, <span class="va">proposal_sigma</span><span class="op">)</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="analisi-dei-risultati" class="level3" data-number="48.7.7"><h3 data-number="48.7.7" class="anchored" data-anchor-id="analisi-dei-risultati">
<span class="header-section-number">48.7.7</span> Analisi dei risultati</h3>
<p>Scartiamo i primi 5000 campioni per considerare solo quelli generati dopo il burn-in:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">burnin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">n_samples</span> <span class="op">*</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">post_burnin_samples</span> <span class="op">&lt;-</span> <span class="va">samples</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">burnin</span><span class="op">)</span><span class="op">]</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Calcoliamo la media e la deviazione standard dei campioni:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Media a posteriori</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">post_burnin_samples</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.163</span></span>
<span></span>
<span><span class="co"># Deviazione standard a posteriori</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">post_burnin_samples</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.0354</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Visualizziamo l’evoluzione della catena per i primi 200 campioni e per quelli post-burn-in:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tibble</span><span class="op">(</span></span>
<span>  Iterazione <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">200</span>,</span>
<span>  Theta <span class="op">=</span> <span class="va">samples</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">200</span><span class="op">]</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Iterazione</span>, y <span class="op">=</span> <span class="va">Theta</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Specifica che vuoi un grafico a linea</span></span>
<span>    <span class="fu">xlab</span><span class="op">(</span><span class="st">"Iterazioni"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Etichetta l'asse X</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span> <span class="co"># Etichetta l'asse Y usando l'espressione per theta</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="01_metropolis_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:85.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tibble</span><span class="op">(</span></span>
<span>  Iterazione <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">post_burnin_samples</span><span class="op">)</span>, </span>
<span>  Theta <span class="op">=</span> <span class="va">post_burnin_samples</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Iterazione</span>, y <span class="op">=</span> <span class="va">Theta</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Specifica un grafico a linea</span></span>
<span>    <span class="fu">xlab</span><span class="op">(</span><span class="st">"Iterazioni"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Indice all'interno della serie post-burn-in</span></span>
<span>    <span class="fu">ylab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span> <span class="co"># Etichetta l'asse Y</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="01_metropolis_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:85.0%"></p>
</figure>
</div>
</div>
</div>
<p>Sovrapponiamo la distribuzione analitica <span class="math inline">\(\text{Beta}(18, 92)\)</span> all’istogramma dei campioni post-burn-in:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Palette di colori alternativa</span></span>
<span><span class="va">colori_custom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"Istogramma"</span> <span class="op">=</span> <span class="st">"#1F77B4"</span>,      <span class="co"># Blu</span></span>
<span>  <span class="st">"Beta(18,92)"</span> <span class="op">=</span> <span class="st">"#FF7F0E"</span>      <span class="co"># Arancione</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>Theta <span class="op">=</span> <span class="va">post_burnin_samples</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Theta</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>    <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="fu">after_stat</span><span class="op">(</span><span class="va">density</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"Istogramma"</span><span class="op">)</span>,</span>
<span>    bins <span class="op">=</span> <span class="fl">30</span>, color <span class="op">=</span> <span class="st">"black"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>, show.legend <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_function</span><span class="op">(</span></span>
<span>    <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Beta(18,92)"</span><span class="op">)</span>,</span>
<span>    fun <span class="op">=</span> <span class="va">dbeta</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>shape1 <span class="op">=</span> <span class="fl">18</span>, shape2 <span class="op">=</span> <span class="fl">92</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1.2</span>,</span>
<span>    show.legend <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>, y <span class="op">=</span> <span class="st">"Densità"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Distribuzione"</span>,</span>
<span>    values <span class="op">=</span> <span class="va">colori_custom</span>,</span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">colori_custom</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Distribuzione"</span>,</span>
<span>    values <span class="op">=</span> <span class="va">colori_custom</span>,</span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">colori_custom</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span></span>
<span>    fill <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">p</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="01_metropolis_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:85.0%"></p>
</figure>
</div>
</div>
</div>
<p>Calcoliamo l’intervallo di credibilità al 94%:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">post_burnin_samples</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.03</span>, <span class="fl">0.97</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    3%   97% </span></span>
<span><span class="co">#&gt; 0.102 0.235</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I valori ottenuti con l’algoritmo di Metropolis (usando solo un piccolo numero di iterazioni) sono quasi identici ai valori esatti:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">qbeta</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.03</span>, <span class="fl">0.97</span><span class="op">)</span>, <span class="fl">18</span>, <span class="fl">92</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.103 0.235</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Questa implementazione in R dimostra come utilizzare l’algoritmo di Metropolis per stimare una distribuzione a posteriori e analizzare i risultati in modo dettagliato e riproducibile.</p>
</section></section><section id="catene-di-markov-e-convergenza" class="level2" data-number="48.8"><h2 data-number="48.8" class="anchored" data-anchor-id="catene-di-markov-e-convergenza">
<span class="header-section-number">48.8</span> Catene di Markov e convergenza</h2>
<p>Nell’ambito delle simulazioni Monte Carlo, una <em>catena</em> rappresenta una sequenza di valori campionati dall’algoritmo durante le sue iterazioni. Ogni valore nella catena corrisponde a un possibile stato del sistema che stiamo modellando. In altre parole, una catena traccia il percorso che l’algoritmo segue nello spazio dei parametri, esplorando le diverse configurazioni possibili.</p>
<p>Per verificare se l’algoritmo ha raggiunto la convergenza e se i campioni generati rappresentano effettivamente la distribuzione di interesse, è utile eseguire <em>multiple catene</em>. Ogni catena parte da un punto iniziale diverso nello spazio dei parametri.</p>
<p><strong>I vantaggi delle multiple catene:</strong></p>
<ul>
<li>
<em>Diagnostica della convergenza:</em> Confrontando le diverse catene, possiamo valutare se si stabilizzano verso la stessa distribuzione. Se le catene si mescolano bene, ovvero si intersecano frequentemente nel grafico dei valori campionati (trace plot), è un forte indicatore di convergenza.</li>
<li>
<em>Robustezza:</em> L’utilizzo di multiple catene rende l’analisi meno sensibile alla scelta del punto di partenza. Se una singola catena potesse rimanere “intrappolata” in una regione dello spazio dei parametri, multiple catene aumentano la probabilità di esplorare lo spazio in modo più completo.</li>
</ul></section><section id="diagnostiche-della-soluzione-mcmc" class="level2" data-number="48.9"><h2 data-number="48.9" class="anchored" data-anchor-id="diagnostiche-della-soluzione-mcmc">
<span class="header-section-number">48.9</span> Diagnostiche della soluzione MCMC</h2>
<section id="stazionarietà-e-convergenza" class="level3" data-number="48.9.1"><h3 data-number="48.9.1" class="anchored" data-anchor-id="stazionarietà-e-convergenza">
<span class="header-section-number">48.9.1</span> Stazionarietà e convergenza</h3>
<p>Un aspetto cruciale nell’analisi delle catene di Markov MCMC è la <em>convergenza</em> alla <em>distribuzione stazionaria</em>. Intuitivamente, la catena converge quando i campioni generati rappresentano fedelmente la distribuzione di interesse, indipendentemente dal punto di partenza. Questo fenomeno è spesso indicato come “mixing”.</p>
<section id="valutazione-visiva-trace-plots-e-grafici-di-densità" class="level4" data-number="48.9.1.1"><h4 data-number="48.9.1.1" class="anchored" data-anchor-id="valutazione-visiva-trace-plots-e-grafici-di-densità">
<span class="header-section-number">48.9.1.1</span> Valutazione visiva: Trace Plots e grafici di densità</h4>
<ul>
<li>
<em>Trace Plots:</em> Questi grafici visualizzano l’evoluzione dei parametri nel tempo. Una catena convergente mostra tracce stabili e senza trend evidenti. Tracce irregolari o con andamenti sistematici suggeriscono problemi di convergenza.</li>
<li>
<em>Grafici di Densità:</em> Confrontando i grafici di densità dei campioni con la distribuzione teorica, è possibile valutare visivamente se la catena sta esplorando adeguatamente lo spazio dei parametri. Una buona convergenza si manifesta con una sovrapposizione tra i due grafici.</li>
</ul>
<p><strong>Segni di Convergenza:</strong></p>
<ul>
<li>
<em>Stabilità:</em> I valori campionati oscillano attorno a un valore medio costante, senza trend marcati.</li>
<li>
<em>Omogeneità:</em> La variabilità dei campioni rimane relativamente uniforme nel tempo.</li>
<li>
<em>Assenza di Periodicità:</em> Non si osservano pattern ciclici o ripetitivi.</li>
</ul>
<p>In sintesi, i trace plots e i grafici di densità offrono strumenti visivi rapidi per valutare la convergenza di una catena di Markov MCMC. Una convergenza soddisfacente è fondamentale per garantire la validità delle inferenze statistiche basate sui campioni generati.</p>
</section></section><section id="autocorrelazione-nelle-catene-di-markov" class="level3" data-number="48.9.2"><h3 data-number="48.9.2" class="anchored" data-anchor-id="autocorrelazione-nelle-catene-di-markov">
<span class="header-section-number">48.9.2</span> Autocorrelazione nelle catene di Markov</h3>
<p>A differenza dei generatori di numeri casuali indipendenti, gli algoritmi MCMC producono una sequenza di campioni <em>correlati</em>. Ogni valore campionato dipende da quello precedente, formando una <em>catena di Markov</em>. Questa interdipendenza è un aspetto fondamentale dell’MCMC.</p>
<p>L’<em>autocorrelazione</em> quantifica il grado di dipendenza tra valori distanti di una certa quantità (detta <em>lag</em>) nella catena. Un’alta autocorrelazione a lag bassi indica una forte dipendenza tra campioni successivi. Al contrario, una rapida diminuzione dell’autocorrelazione al crescere del lag suggerisce che la catena “miscela” bene, ovvero esplora lo spazio dei parametri in modo efficiente.</p>
<ul>
<li>
<em>Lag 1:</em> Misura la correlazione tra valori consecutivi nella catena.</li>
<li>
<em>Lag 2:</em> Misura la correlazione tra valori separati da un passo intermedio.</li>
<li>
<em>Lag k:</em> Generalizza il concetto ai valori separati da k passi.</li>
</ul>
<p>Un <em>correlogramma</em> è un grafico che mostra l’autocorrelazione in funzione del lag. Un decadimento rapido dell’autocorrelazione verso zero indica una buona convergenza della catena.</p>
<p>L’autocorrelazione di ordine <span class="math inline">\(k\)</span> è data da <span class="math inline">\(\rho_k\)</span> e può essere stimata come:</p>
<p><span id="eq-autocor"><span class="math display">\[
\begin{aligned}
\rho_k &amp;= \frac{Cov(\theta_m, \theta_{m+k})}{Var(\theta_m)}\notag\\
&amp;= \frac{\sum_{m=1}^{n-k}(\theta_m - \bar{\theta})(\theta_{m-k} - \bar{\theta})}{\sum_{m=1}^{n-k}(\theta_m - \bar{\theta})^2} \qquad\text{con }\quad \bar{\theta} = \frac{1}{n}\sum_{m=1}^{n}\theta_m.
\end{aligned}
\tag{48.1}\]</span></span></p>
</section><section id="esempio-di-simulazione-di-dati-autocorrelati" class="level3" data-number="48.9.3"><h3 data-number="48.9.3" class="anchored" data-anchor-id="esempio-di-simulazione-di-dati-autocorrelati">
<span class="header-section-number">48.9.3</span> Esempio di simulazione di dati autocorrelati</h3>
<p>Per fare un esempio pratico, creiamo un vettore di dati autocorrelati:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Creiamo un vettore di dati</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">22</span>, <span class="fl">24</span>, <span class="fl">25</span>, <span class="fl">25</span>, <span class="fl">28</span>, <span class="fl">29</span>, <span class="fl">34</span>, <span class="fl">37</span>, <span class="fl">40</span>, <span class="fl">44</span>, <span class="fl">51</span>, <span class="fl">48</span>, <span class="fl">47</span>, <span class="fl">50</span>, <span class="fl">51</span><span class="op">)</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt;  [1] 22 24 25 25 28 29 34 37 40 44 51 48 47 50 51</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="calcolo-dellautocorrelazione" class="level4" data-number="48.9.3.1"><h4 data-number="48.9.3.1" class="anchored" data-anchor-id="calcolo-dellautocorrelazione">
<span class="header-section-number">48.9.3.1</span> Calcolo dell’autocorrelazione</h4>
<p>L’autocorrelazione di ordine 1 è la correlazione tra ciascun elemento e il successivo nella sequenza. In R possiamo utilizzare la funzione <code><a href="https://rdrr.io/r/stats/acf.html">acf()</a></code> per calcolare l’autocorrelazione.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calcolo dell'autocorrelazione</span></span>
<span><span class="va">acf_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/acf.html">acf</a></span><span class="op">(</span><span class="va">x</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">acf_values</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Autocorrelations of series 'x', by lag</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      0      1      2      3      4      5      6      7      8      9     10 </span></span>
<span><span class="co">#&gt;  1.000  0.832  0.656  0.491  0.279  0.031 -0.165 -0.304 -0.401 -0.458 -0.450 </span></span>
<span><span class="co">#&gt;     11 </span></span>
<span><span class="co">#&gt; -0.369</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nell’esempio, il vettore <code>x</code> rappresenta una serie temporale di 15 elementi. Il calcolo dell’autocorrelazione restituisce i seguenti valori per i primi ritardi (<em>lag</em>):</p>
<ul>
<li>0.8317: autocorrelazione di ordine 1 (lag = 1),</li>
<li>0.6563: autocorrelazione di ordine 2 (lag = 2),</li>
<li>0.4910: autocorrelazione di ordine 3 (lag = 3),<br>
ecc.</li>
</ul></section><section id="specifica-del-numero-di-ritardi-lag" class="level4" data-number="48.9.3.2"><h4 data-number="48.9.3.2" class="anchored" data-anchor-id="specifica-del-numero-di-ritardi-lag">
<span class="header-section-number">48.9.3.2</span> Specifica del numero di ritardi (<em>Lag</em>)</h4>
<p>Possiamo limitare il numero di ritardi calcolati utilizzando l’argomento <code>lag.max</code> nella funzione <code><a href="https://rdrr.io/r/stats/acf.html">acf()</a></code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Calcolo dell'autocorrelazione per i primi 4 lag</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/acf.html">acf</a></span><span class="op">(</span><span class="va">x</span>, lag.max <span class="op">=</span> <span class="fl">4</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Autocorrelations of series 'x', by lag</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     0     1     2     3     4 </span></span>
<span><span class="co">#&gt; 1.000 0.832 0.656 0.491 0.279</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="grafico-della-funzione-di-autocorrelazione-correlogramma" class="level4" data-number="48.9.3.3"><h4 data-number="48.9.3.3" class="anchored" data-anchor-id="grafico-della-funzione-di-autocorrelazione-correlogramma">
<span class="header-section-number">48.9.3.3</span> Grafico della funzione di autocorrelazione (correlogramma)</h4>
<p>In R possiamo creare un correlogramma con la funzione <code><a href="https://rdrr.io/r/stats/acf.html">acf()</a></code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Correlogramma per la serie temporale</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/acf.html">acf</a></span><span class="op">(</span><span class="va">x</span>, main <span class="op">=</span> <span class="st">"Correlogramma della Serie Temporale"</span>, lag.max <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="01_metropolis_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:85.0%"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="analisi-della-catena-di-markov" class="level3" data-number="48.9.4"><h3 data-number="48.9.4" class="anchored" data-anchor-id="analisi-della-catena-di-markov">
<span class="header-section-number">48.9.4</span> Analisi della catena di Markov</h3>
<p>Applichiamo lo stesso approccio alla catena di Markov ottenuta precedentemente, considerando i campioni post burn-in:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Definizione dei campioni post burn-in</span></span>
<span><span class="va">post_burnin_samples</span> <span class="op">&lt;-</span> <span class="va">samples</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">burnin</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Correlogramma per i campioni post burn-in</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/acf.html">acf</a></span><span class="op">(</span></span>
<span>  <span class="va">post_burnin_samples</span>, </span>
<span>  main <span class="op">=</span> <span class="st">"Correlogramma della Catena Post Burn-in"</span>, </span>
<span>  lag.max <span class="op">=</span> <span class="fl">9</span></span>
<span><span class="op">)</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="01_metropolis_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:85.0%"></p>
</figure>
</div>
</div>
</div>
<p>In situazioni ideali, l’autocorrelazione diminuisce rapidamente, diventando insignificante per piccoli lag. Questo comportamento è un’indicazione del “mixing” efficace della catena, ossia della sua convergenza alla distribuzione stazionaria.</p>
</section><section id="sottocampionamento-thinning" class="level3" data-number="48.9.5"><h3 data-number="48.9.5" class="anchored" data-anchor-id="sottocampionamento-thinning">
<span class="header-section-number">48.9.5</span> Sottocampionamento (<em>thinning</em>)</h3>
<p>Per ridurre l’autocorrelazione, possiamo applicare una strategia di sottocampionamento (<em>thinning</em>), memorizzando solo ogni <span class="math inline">\(m\)</span>-esimo campione.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Sottocampionamento con un fattore di 5</span></span>
<span><span class="va">thin</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">sampsthin</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">post_burnin_samples</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">post_burnin_samples</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">thin</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Correlogramma per i campioni sottocampionati</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/acf.html">acf</a></span><span class="op">(</span></span>
<span>  <span class="va">sampsthin</span>, </span>
<span>  main <span class="op">=</span> <span class="st">"Correlogramma con Sottocampionamento (Thinning)"</span>, </span>
<span>  lag.max <span class="op">=</span> <span class="fl">9</span></span>
<span><span class="op">)</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="01_metropolis_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:85.0%"></p>
</figure>
</div>
</div>
</div>
<p>In conclusione, il correlogramma con <em>thinning</em> mostra che l’autocorrelazione diminuisce più rapidamente rispetto ai campioni originali, suggerendo che la strategia di sottocampionamento è efficace nel migliorare l’indipendenza tra i campioni successivi. Questo migliora la qualità delle inferenze basate sulla catena di Markov.</p>
<section id="tasso-di-accettazione" class="level4" data-number="48.9.5.1"><h4 data-number="48.9.5.1" class="anchored" data-anchor-id="tasso-di-accettazione">
<span class="header-section-number">48.9.5.1</span> Tasso di accettazione</h4>
<p>Quando si utilizza l’algoritmo Metropolis, è importante monitorare il tasso di accettazione e assicurarsi che sia nell’intervallo ottimale. Se si accetta quasi sempre il candidato proposto, probabilmente significa che, in ogni iterazione, la catena salta solo di un piccolo passo (in modo che il rapporto di accettazione sia vicino a 1 ogni volta). Di conseguenza, la catena impiegherà molte iterazioni per raggiungere altre regioni della distribuzione stazionaria e i campioni consecutivi saranno molto fortemente correlati. D’altra parte, se il tasso di accettazione è molto basso, la catena rimarrà bloccata nella stessa posizione per molte iterazioni prima di spostarsi verso uno stato diverso. Per l’algoritmo Metropolis base con un singolo parametro con una distribuzione proposta Gaussiana normale, un tasso di accettazione ottimale è compreso tra il 40% e il 50%.</p>
</section></section><section id="test-statistici-per-la-convergenza" class="level3" data-number="48.9.6"><h3 data-number="48.9.6" class="anchored" data-anchor-id="test-statistici-per-la-convergenza">
<span class="header-section-number">48.9.6</span> Test statistici per la convergenza</h3>
<p>Oltre agli approcci grafici, esistono test statistici specifici che possono aiutare a determinare se la catena ha raggiunto uno stato stazionario.</p>
<section id="test-di-geweke" class="level4" data-number="48.9.6.1"><h4 data-number="48.9.6.1" class="anchored" data-anchor-id="test-di-geweke">
<span class="header-section-number">48.9.6.1</span> Test di Geweke</h4>
<p>Il test di Geweke è una procedura che confronta le medie di due segmenti della catena di campionamento, tipicamente il primo 10% e l’ultimo 50% dei campioni, dopo aver escluso un iniziale periodo di “burn-in” (una fase iniziale durante la quale la catena potrebbe non essere ancora convergente). La premessa di base è che, se la catena è in uno stato stazionario, le medie di questi due segmenti dovrebbero essere sostanzialmente uguali. Differenze importanti tra queste medie possono indicare che la catena non ha ancora raggiunto la convergenza.</p>
</section><section id="geweke-z-score" class="level4" data-number="48.9.6.2"><h4 data-number="48.9.6.2" class="anchored" data-anchor-id="geweke-z-score">
<span class="header-section-number">48.9.6.2</span> Geweke Z-score</h4>
<p>Una variante del test di Geweke è lo z-score di Geweke, che offre un modo quantitativo per valutare le differenze tra i segmenti della catena. Questo test calcola uno z-score che confronta le medie dei due segmenti tenendo conto della varianza. Un valore di z-score:</p>
<ul>
<li>
<strong>Al di sotto di 2 (in valore assoluto)</strong> suggerisce che non ci sono differenze degne di nota tra i segmenti, indicando che la catena potrebbe essere in stato stazionario.</li>
<li>
<strong>Superiore a 2 (in valore assoluto)</strong> indica che esiste una differenza degna di nota tra i segmenti, suggerendo che la catena non ha raggiunto la convergenza e potrebbe essere necessario un periodo di burn-in più esteso.</li>
</ul>
<p>Entrambi i metodi forniscono strumenti utili per valutare la convergenza delle catene MCMC. È importante notare che nessun test può garantire con certezza la convergenza, ma l’utilizzo congiunto di approcci grafici e test statistici può offrire una buona indicazione dello stato della catena.</p>
</section></section><section id="dimensione-del-campione-effettiva-ess" class="level3" data-number="48.9.7"><h3 data-number="48.9.7" class="anchored" data-anchor-id="dimensione-del-campione-effettiva-ess">
<span class="header-section-number">48.9.7</span> Dimensione del campione effettiva (ESS)</h3>
<p>La correlazione tra campioni consecutivi in una catena MCMC riduce l’informazione effettiva contenuta in ogni iterazione. La <em>dimensione del campione effettiva (ESS)</em> quantifica questa perdita di informazione dovuta alla dipendenza tra i campioni, stimando il numero equivalente di campioni indipendenti. Un valore basso di ESS indica una forte correlazione tra i campioni e una convergenza più lenta della catena.</p>
<p>L’ESS descrive l’efficacia del campionamento dipendente in termini di campioni indipendenti estratti dalla stessa distribuzione. Rappresenta un indicatore dell’efficienza del campionamento e dell’autocorrelazione della catena.</p>
<p>La formula per stimare la dimensione del campione effettiva (ESS) di una catena di Markov è:</p>
<p><span class="math display">\[
\text{ESS} = \frac{N}{1 + 2 \sum_{t=1}^{T} \rho_t},
\]</span></p>
<p>dove:</p>
<ul>
<li>
<span class="math inline">\(N\)</span> è il numero totale di campioni nella catena,</li>
<li>
<span class="math inline">\(T\)</span> è il lag, ovvero il numero massimo di termini di autocorrelazione considerati,</li>
<li>
<span class="math inline">\(\rho_t\)</span> è l’autocorrelazione al lag <span class="math inline">\(t\)</span>, ossia la correlazione tra due campioni consecutivi separati da <span class="math inline">\(t\)</span> iterazioni.</li>
</ul>
<p>In pratica, <span class="math inline">\(T\)</span> viene scelto in modo tale che <span class="math inline">\(\rho_T\)</span> sia sufficientemente piccolo, indicando che l’autocorrelazione è quasi svanita. La somma <span class="math inline">\(\sum_{t=1}^T \rho_t\)</span> viene quindi troncata approssimativamente a <span class="math inline">\(T\)</span>, poiché i contributi delle autocorrelazioni successive diventano trascurabili.</p>
</section><section id="calcolo-della-statistica-di-gelman-rubin-hatr" class="level3" data-number="48.9.8"><h3 data-number="48.9.8" class="anchored" data-anchor-id="calcolo-della-statistica-di-gelman-rubin-hatr">
<span class="header-section-number">48.9.8</span> Calcolo della statistica di Gelman-Rubin (<span class="math inline">\(\hat{R}\)</span>)</h3>
<p>Per calcolare la statistica di Gelman-Rubin (spesso indicata come <span class="math inline">\(\hat{R}\)</span>), è necessario eseguire più catene e confrontare la variabilità all’interno di ciascuna catena con la variabilità tra le catene. Ecco i passaggi per calcolare <span class="math inline">\(\hat{R}\)</span>:</p>
<ol type="1">
<li>Esegui <span class="math inline">\(m\)</span> catene di Markov di lunghezza <span class="math inline">\(n\)</span>, dove <span class="math inline">\(m\)</span> è solitamente maggiore di 1.</li>
<li>Per ciascun parametro scalare <span class="math inline">\(\theta\)</span>, calcola la varianza all’interno delle catene (<span class="math inline">\(W\)</span>) e la varianza tra le catene (<span class="math inline">\(B\)</span>).</li>
<li>Calcola la varianza combinata <span class="math inline">\(\hat{V}\)</span> come media ponderata delle varianze all’interno delle catene.</li>
<li>Calcola il fattore di riduzione della scala potenziale <span class="math inline">\(\hat{R}\)</span> come la radice quadrata del rapporto tra la varianza combinata <span class="math inline">\(\hat{V}\)</span> e la varianza all’interno delle catene <span class="math inline">\(W\)</span>:</li>
</ol>
<p><span class="math display">\[
\hat{R} = \sqrt{\frac{\hat{V}}{W}}.
\]</span></p>
<ol start="5" type="1">
<li>Se <span class="math inline">\(\hat{R}\)</span> è vicino a 1, ciò indica che le catene sono in convergenza.</li>
</ol>
<p>La statistica di Gelman-Rubin <span class="math inline">\(\hat{R}\)</span> è una misura di convergenza per le catene di Markov. Essa quantifica il grado di accordo tra più catene, fornendo uno strumento diagnostico per valutare la convergenza nelle simulazioni MCMC.</p>
</section></section><section id="vantaggi-del-campionamento-mcmc-rispetto-alle-soluzioni-analitiche" class="level2" data-number="48.10"><h2 data-number="48.10" class="anchored" data-anchor-id="vantaggi-del-campionamento-mcmc-rispetto-alle-soluzioni-analitiche">
<span class="header-section-number">48.10</span> Vantaggi del campionamento MCMC rispetto alle soluzioni analitiche</h2>
<p>Il campionamento MCMC offre notevoli vantaggi pratici rispetto alle soluzioni analitiche nella statistica bayesiana, in particolare quando si tratta di manipolare distribuzioni a posteriori. Sebbene l’impossibilità di calcolare analiticamente la distribuzione a posteriori sia spesso la motivazione principale per l’uso di MCMC, i benefici di questo approccio si estendono ben oltre questa necessità <span class="citation" data-cites="buerkner2024brms">(<a href="#ref-buerkner2024brms" role="doc-biblioref">Bürkner, 2024</a>)</span>.</p>
<section id="facilità-di-manipolazione-e-flessibilità" class="level3" data-number="48.10.1"><h3 data-number="48.10.1" class="anchored" data-anchor-id="facilità-di-manipolazione-e-flessibilità">
<span class="header-section-number">48.10.1</span> Facilità di manipolazione e flessibilità</h3>
<p>Il vantaggio chiave del campionamento MCMC risiede nella semplicità con cui si possono manipolare i campioni ottenuti. Mentre le densità calcolate analiticamente possono richiedere trasformazioni matematiche complesse, i campioni MCMC possono essere facilmente trasformati con operazioni dirette.</p>
<p>In conclusione, il campionamento MCMC non è solo una necessità quando le soluzioni analitiche sono introvabili, ma offre vantaggi in termini di facilità di manipolazione, flessibilità computazionale e applicabilità pratica.</p>
</section></section><section id="caso-normale-normale-con-soluzione-analitica" class="level2" data-number="48.11"><h2 data-number="48.11" class="anchored" data-anchor-id="caso-normale-normale-con-soluzione-analitica">
<span class="header-section-number">48.11</span> Caso Normale-Normale con soluzione analitica</h2>
<p>Applichiamo ora l’algoritmo di Metropolis al caso Normale-Normale di cui conosciamo la soluzione analitica. In pratica, ci poniamo il problema di capire quale valore di <span class="math inline">\(\mu\)</span> (la media vera di una popolazione) sia più plausibile, dopo aver osservato alcuni dati. Abbiamo:</p>
<ul>
<li>un’idea iniziale (prior) che dice che <span class="math inline">\(\mu\)</span> dovrebbe stare attorno a 30, con una certa incertezza (deviazione standard 5),</li>
<li>e abbiamo i dati osservati (<span class="math inline">\(y\)</span>) che ci danno informazioni aggiuntive su dove si trova davvero <span class="math inline">\(\mu\)</span>.</li>
</ul>
<p>Ma non conosciamo esattamente la distribuzione a posteriori di <span class="math inline">\(\mu\)</span>.</p>
<p>Vogliamo costruire una “nuvola” di valori plausibili per <span class="math inline">\(\mu\)</span> basandoci su dati e prior. Il metodo che usiamo per risolvere questo problema è l’algoritmo di Metropolis.</p>
<p><strong>Step 1. Partiamo da un punto.</strong></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x_prev</span> <span class="op">&lt;-</span> <span class="va">xinit</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>
<em>xinit</em> è il valore iniziale: il nostro “primo sospetto” su dove si trovi <span class="math inline">\(\mu\)</span>.</li>
<li>È come partire da un punto sulla mappa (“Penso che <span class="math inline">\(\mu\)</span> sia circa qui”).</li>
</ul>
<p><strong>Step 2. Proponiamo un nuovo punto vicino.</strong></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x_star</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="va">x_prev</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Immaginiamo di essere bendati e di provare a fare <em>un piccolo passo a caso</em> partendo da dove siamo ora.</li>
<li>Quel passo è generato con una distribuzione normale centrata su <em>x_prev</em> e con una deviazione standard piccola (<em>0.5</em>): <em>piccoli passi casuali</em> attorno al punto attuale.</li>
</ul>
<p><strong>Nota intuitiva:</strong><br>
Il valore 0.5 decide quanto “grandi” o “piccoli” sono i nostri passi. Più è grande, più possiamo saltare lontano; più è piccolo, più restiamo vicino.</p>
<p><strong>Step 3. Calcoliamo quanto è “buono” il nuovo punto.</strong></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">posterior</span><span class="op">(</span><span class="va">x_star</span>, <span class="va">data</span><span class="op">)</span></span>
<span><span class="fu">posterior</span><span class="op">(</span><span class="va">x_prev</span>, <span class="va">data</span><span class="op">)</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Ogni punto sulla mappa (<span class="math inline">\(\mu\)</span>) ha un certo <em>valore di plausibilità</em>: quanto è probabile dati i dati osservati e il prior.</li>
<li>
<em>posterior(x_star, data)</em> ci dice: “quanto è buono il nuovo punto?”</li>
<li>
<em>posterior(x_prev, data)</em> ci dice: “quanto era buono quello vecchio?”</li>
</ul>
<p><strong>Step 4. Decidiamo se accettare il nuovo punto.</strong></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu">posterior</span><span class="op">(</span><span class="va">x_star</span>, <span class="va">data</span><span class="op">)</span> <span class="op">/</span> <span class="fu">posterior</span><span class="op">(</span><span class="va">x_prev</span>, <span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x_prev</span> <span class="op">&lt;-</span> <span class="va">x_star</span></span>
<span><span class="op">}</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Qui applichiamo il meccanismo di base dell’algoritmo di Metropolis per decidere sull’accettazione di un nuovo punto:</p>
<ul>
<li>
<em>se il nuovo punto è migliore</em> (cioè, la probabilità a posteriori è maggiore), allora lo <em>accettiamo sicuramente</em> (<span class="math inline">\(\alpha &gt; 1\)</span>, quindi <span class="math inline">\(\min(1, \alpha) = 1\)</span>);</li>
<li>
<em>se il nuovo punto è peggiore</em>, possiamo comunque <em>accettarlo con una certa probabilità</em>:
<ul>
<li>la probabilità di accettazione diminuisce all’aumentare di quanto il punto è “peggiore”;</li>
<li>ciò è essenziale per <em>non rimanere bloccati</em> nei massimi locali.</li>
</ul>
</li>
</ul>
<p><em>In parole semplici:</em></p>
<ul>
<li>se troviamo un posto migliore, ci andiamo;</li>
<li>se troviamo un posto peggiore, possiamo comunque andarci… ma tirando una monetina.</li>
</ul>
<p><strong>Step 5. Registriamo il punto attuale</strong></p>
<p>Dopo aver deciso se accettare o meno il nuovo valore proposto, salviamo sempre un punto nella catena.</p>
<p>Ma attenzione:</p>
<ul>
<li>
<em>se la proposta è stata accettata</em>, ci spostiamo al nuovo punto e lo registriamo;</li>
<li>
<em>se la proposta è stata rifiutata</em>, restiamo fermi e registriamo <strong>di nuovo</strong> la posizione attuale.</li>
</ul>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu">posterior</span><span class="op">(</span><span class="va">x_star</span>, <span class="va">data</span><span class="op">)</span> <span class="op">/</span> <span class="fu">posterior</span><span class="op">(</span><span class="va">x_prev</span>, <span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x_prev</span> <span class="op">&lt;-</span> <span class="va">x_star</span>  <span class="co"># accettiamo: ci spostiamo</span></span>
<span><span class="op">}</span></span>
<span><span class="va">samples</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x_prev</span>  <span class="co"># salviamo dove ci troviamo ORA</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In entrambi i casi, <code>samples[i]</code> tiene traccia della posizione in cui ci troviamo dopo l’iterazione.</p>
<p><strong>Intuizione: l’escursionista bendato.</strong></p>
<p>Immaginiamo un’escursionista bendato che vuole esplorare un paesaggio fatto di colline di plausibilità (la distribuzione a posteriori):</p>
<ul>
<li>a ogni passo, <em>prova a fare un salto</em> in una nuova direzione (<code>x_star</code>);</li>
<li>se quel punto è più alto o non troppo peggiore, <em>accetta</em> di andarci e si sposta.</li>
<li>se il punto è troppo brutto, <em>rimane fermo</em> dov’è;</li>
<li><em>in ogni caso, segna nel diario la sua posizione attuale.</em></li>
</ul>
<p>Ecco perché, quando guardiamo la catena, possiamo trovare <em>valori ripetuti</em> consecutivi: l’escursionista non si è mosso.</p>
<p>Questa caratteristica – il fatto che i campioni non siano tutti diversi – <em>non è un errore</em>, ma una proprietà fondamentale dell’algoritmo Metropolis: i campioni sono <em>dipendenti</em> e possono <em>ripetersi</em>.</p>
<p><strong>Step 6. Ripetiamo tante volte.</strong></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">nsamp</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="va">...</span> <span class="op">}</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Più a lungo ripetiamo il processo (più iterazioni), più densa e accurata sarà la nostra approssimazione della distribuzione a posteriori di <span class="math inline">\(\mu\)</span>.</li>
<li>Dopo un po’, <em>i valori salvati</em> formeranno un disegno della distribuzione plausibile di <span class="math inline">\(\mu\)</span>.</li>
</ul>
<p>** Riassunto in 3 frasi:**</p>
<ul>
<li><ol type="1">
<li>Partiamo da un valore sospettato di <span class="math inline">\(\mu\)</span>.</li>
</ol></li>
<li><ol start="2" type="1">
<li>Facciamo piccoli passi casuali e decidiamo se accettarli in base a quanto sono “buoni” rispetto ai dati + prior.</li>
</ol></li>
<li><ol start="3" type="1">
<li>Dopo molti passi, la sequenza dei punti disegna la distribuzione a posteriori di <span class="math inline">\(\mu\)</span>.</li>
</ol></li>
</ul>
<p>** Dopo il sampling:**</p>
<ul>
<li>possiamo <em>calcolare la media</em> dei campioni = stima puntuale di <span class="math inline">\(\mu\)</span>;</li>
<li>possiamo <em>costruire un intervallo di credibilità</em> = incertezza su <span class="math inline">\(\mu\)</span>;</li>
<li>possiamo <em>disegnare un istogramma</em> dei campioni = forma della distribuzione a posteriori.</li>
</ul>
<p>Anche se l’algoritmo di Metropolis può sembrare “rozzo” (tanti piccoli passi + accettare/rifiutare), funziona <em>benissimo</em> ed è uno dei motivi per cui oggi possiamo applicare la statistica bayesiana a modelli anche <em>molto complessi</em>.</p>
<p>Applichiamo dunque l’algoritmo di Metropolis all’esercizio in discussione. Iniziamo a definire le funzioni per il prior, la verosimiglianza e il posterior non normalizzato.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Prior: Normal(30, 5^2)</span></span>
<span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mu</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">mu</span>, mean <span class="op">=</span> <span class="fl">30</span>, sd <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Likelihood: Normal(mu, sigma^2) con sigma calcolata dai dati</span></span>
<span><span class="va">likelihood</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mu</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>  <span class="co"># Deviazione standard dei dati</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">data</span>, mean <span class="op">=</span> <span class="va">mu</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Posterior non normalizzato</span></span>
<span><span class="va">posterior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mu</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">likelihood</span><span class="op">(</span><span class="va">mu</span>, <span class="va">data</span><span class="op">)</span> <span class="op">*</span> <span class="fu">prior</span><span class="op">(</span><span class="va">mu</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Implementiamo l’algoritmo di Metropolis per il caso normale-normale:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Algoritmo di Metropolis</span></span>
<span><span class="va">metropolis_for_normal</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">nsamp</span>, <span class="va">xinit</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="va">nsamp</span><span class="op">)</span></span>
<span>  <span class="va">x_prev</span> <span class="op">&lt;-</span> <span class="va">xinit</span></span>
<span>  </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">nsamp</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x_star</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="va">x_prev</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>  <span class="co"># Proposta</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu">posterior</span><span class="op">(</span><span class="va">x_star</span>, <span class="va">data</span><span class="op">)</span> <span class="op">/</span> <span class="fu">posterior</span><span class="op">(</span><span class="va">x_prev</span>, <span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">x_prev</span> <span class="op">&lt;-</span> <span class="va">x_star</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">samples</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x_prev</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">samples</span></span>
<span><span class="op">}</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Utilizziamo un campione di 30 valori BDI-II forniti da <span class="citation" data-cites="zetsche_2019future">Zetsche et al. (<a href="#ref-zetsche_2019future" role="doc-biblioref">2019</a>)</span>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Dati osservati</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">26</span>, <span class="fl">35</span>, <span class="fl">30</span>, <span class="fl">25</span>, <span class="fl">44</span>, <span class="fl">30</span>, <span class="fl">33</span>, <span class="fl">43</span>, <span class="fl">22</span>, <span class="fl">43</span>, <span class="fl">24</span>, <span class="fl">19</span>, <span class="fl">39</span>, <span class="fl">31</span>, <span class="fl">25</span>, </span>
<span>  <span class="fl">28</span>, <span class="fl">35</span>, <span class="fl">30</span>, <span class="fl">26</span>, <span class="fl">31</span>, <span class="fl">41</span>, <span class="fl">36</span>, <span class="fl">26</span>, <span class="fl">35</span>, <span class="fl">33</span>, <span class="fl">28</span>, <span class="fl">27</span>, <span class="fl">34</span>, <span class="fl">27</span>, <span class="fl">22</span></span>
<span><span class="op">)</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Esecuzione dell’algoritmo:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu">metropolis_for_normal</span><span class="op">(</span><span class="fl">100000</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, <span class="va">y</span><span class="op">)</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nel caso normale-normale, il posterior può essere calcolato analiticamente come segue:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Parametri del prior</span></span>
<span><span class="va">mu_prior</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span><span class="va">std_prior</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">var_prior</span> <span class="op">&lt;-</span> <span class="va">std_prior</span><span class="op">^</span><span class="fl">2</span></span>
<span></span>
<span><span class="co"># Calcolo dei parametri posterior</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">sum_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">var_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mu_post</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">mu_prior</span> <span class="op">/</span> <span class="va">var_prior</span> <span class="op">+</span> <span class="va">sum_y</span> <span class="op">/</span> <span class="va">var_data</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">var_prior</span> <span class="op">+</span> <span class="va">n</span> <span class="op">/</span> <span class="va">var_data</span><span class="op">)</span></span>
<span><span class="va">var_post</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">var_prior</span> <span class="op">+</span> <span class="va">n</span> <span class="op">/</span> <span class="va">var_data</span><span class="op">)</span></span>
<span><span class="va">std_post</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var_post</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mu_post</span></span>
<span><span class="co">#&gt; [1] 30.9</span></span>
<span><span class="va">std_post</span></span>
<span><span class="co">#&gt; [1] 1.17</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Visualizziamo i risultati con un istogramma dei campioni MCMC e la curva della distribuzione analitica:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># ── Curva analitica del posterior (normale) ───────────────────────────</span></span>
<span><span class="va">x</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">mu_post</span> <span class="op">-</span> <span class="fl">4</span> <span class="op">*</span> <span class="va">std_post</span>, <span class="va">mu_post</span> <span class="op">+</span> <span class="fl">4</span> <span class="op">*</span> <span class="va">std_post</span>, length.out <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">df_line</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, dens <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">x</span>, mean <span class="op">=</span> <span class="va">mu_post</span>, sd <span class="op">=</span> <span class="va">std_post</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ── Campioni post burn-in per l'istogramma ────────────────────────────</span></span>
<span><span class="va">burnin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="fl">0.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">post_samples</span> <span class="op">&lt;-</span> <span class="va">samples</span><span class="op">[</span><span class="op">(</span><span class="va">burnin</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">df_hist</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>val <span class="op">=</span> <span class="va">post_samples</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Binwidth data-driven (Freedman–Diaconis)</span></span>
<span><span class="va">bw_fd</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/IQR.html">IQR</a></span><span class="op">(</span><span class="va">post_samples</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">post_samples</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">colori_okabe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"MCMC"</span> <span class="op">=</span> <span class="st">"#56B4E9"</span>, <span class="st">"Analitico"</span> <span class="op">=</span> <span class="st">"#009E73"</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">df_hist</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">val</span>, y <span class="op">=</span> <span class="fu">after_stat</span><span class="op">(</span><span class="va">density</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"MCMC"</span><span class="op">)</span>,</span>
<span>    bins <span class="op">=</span> <span class="fl">30</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    color <span class="op">=</span> <span class="cn">NA</span>                          <span class="co"># niente bordo: look più editoriale</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">df_line</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">dens</span>, color <span class="op">=</span> <span class="st">"Analitico"</span><span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1.1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span>, y <span class="op">=</span> <span class="st">"Densità"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Distribuzione"</span>,</span>
<span>    values <span class="op">=</span> <span class="va">colori_okabe</span>,</span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">colori_okabe</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Distribuzione"</span>,</span>
<span>    values <span class="op">=</span> <span class="va">colori_okabe</span>,</span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">colori_okabe</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span></span>
<span>    fill  <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="cn">NA</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>fill  <span class="op">=</span> <span class="cn">NA</span>, linewidth <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    legend.box <span class="op">=</span> <span class="st">"horizontal"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="01_metropolis_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:85.0%"></p>
</figure>
</div>
</div>
</div>
<p>Troviamo le proprietà del Posterior derivato con MCMC:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 30.9</span></span>
<span><span class="co">#&gt; [1] 1.18</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In conclusione, questo esempio illustra l’applicazione dell’algoritmo di Metropolis per la stima di una distribuzione a posteriori nel caso Normale-Normale e dimostra come confrontare i risultati del campionamento con la soluzione analitica, confermando così la coerenza tra le due approcci.</p>
</section><section id="riflessioni-conclusive" class="level2 unnumbered unlisted"><h2 class="unnumbered unlisted anchored" data-anchor-id="riflessioni-conclusive">Riflessioni conclusive</h2>
<p>L’algoritmo di Metropolis segna un punto di svolta nell’inferenza bayesiana. Prima della sua introduzione, l’analisi bayesiana era praticabile solo in casi molto semplici, con distribuzioni coniugate o con un numero ridotto di parametri. Con Metropolis, invece, diventa possibile ottenere un campione casuale dalla distribuzione a posteriori in modo generale, senza bisogno di conoscere la sua forma analitica.</p>
<p>Questa è la sua forza: concettualmente, il problema dell’inferenza bayesiana è risolto. Possiamo sempre, almeno in linea di principio, campionare dalla posterior. I limiti che rimangono sono di tipo pratico: efficienza computazionale e complessità di implementazione. Non a caso, gran parte dello sviluppo successivo – da Metropolis-Hastings fino all’algoritmo NUTS usato da Stan – può essere visto come un raffinamento tecnico per rendere più veloce e più automatizzato ciò che Metropolis aveva già reso possibile. Dal punto di vista didattico, questo rende l’algoritmo di Metropolis un capitolo fondamentale del nostro percorso: non è solo un algoritmo storico, ma il cuore concettuale dell’inferenza bayesiana moderna. Comprenderne la logica permette di interpretare con maggiore consapevolezza anche i metodi più avanzati, che pur nella loro complessità tecnica non fanno che sviluppare ulteriormente questa idea di base <span class="citation" data-cites="duane1987hybrid hanada2022mcmc geman_geman_1984 hoffman2014no">(<a href="#ref-duane1987hybrid" role="doc-biblioref">Duane et al., 1987</a>; <a href="#ref-geman_geman_1984" role="doc-biblioref">Geman &amp; Geman, 1984</a>; <a href="#ref-hanada2022mcmc" role="doc-biblioref">Hanada &amp; Matsuura, 2022</a>; <a href="#ref-hoffman2014no" role="doc-biblioref">Hoffman et al., 2014</a>)</span>.</p>
<p>In conclusione, l’algoritmo di Metropolis ci insegna due lezioni fondamentali: primo, che l’inferenza bayesiana non è limitata ai casi speciali, ma è sempre possibile; secondo, che ogni modello psicologico, anche il più complesso, può essere affrontato con questa logica, a patto di disporre degli strumenti computazionali adeguati.</p>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Esercizio 1: Autostima negli Studenti Universitari">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Esercizio 1: Autostima negli Studenti Universitari
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In un campione casuale di 100 studenti, 25 hanno mostrato livelli alti di autostima.<br>
Supponiamo un prior Beta(2,8) sulla proporzione <span class="math inline">\(\theta\)</span> di studenti con alta autostima.</p>
<p>Obiettivo: stimare la distribuzione a posteriori di <span class="math inline">\(\theta\)</span> usando l’<strong>algoritmo di Metropolis</strong>.</p>
<p><strong>Definizione delle Funzioni.</strong></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>  <span class="co"># per riproducibilità</span></span>
<span></span>
<span><span class="co"># Prior: Beta(2,8)</span></span>
<span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">dbeta</a></span><span class="op">(</span><span class="va">p</span>, shape1 <span class="op">=</span> <span class="fl">2</span>, shape2 <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Likelihood: binomiale 25 successi su 100</span></span>
<span><span class="va">likelihood</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">dbinom</a></span><span class="op">(</span><span class="fl">25</span>, size <span class="op">=</span> <span class="fl">100</span>, prob <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Posterior non normalizzata</span></span>
<span><span class="va">posterior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="fu">prior</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="op">*</span> <span class="fu">likelihood</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Distribuzione di proposta</span></span>
<span><span class="va">proposal_distribution</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">current</span>, <span class="va">proposal_sigma</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="va">current</span>, sd <span class="op">=</span> <span class="va">proposal_sigma</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Algoritmo di Metropolis</span></span>
<span><span class="va">metropolis</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n_samples</span>, <span class="va">start</span>, <span class="va">proposal_sigma</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="va">n_samples</span><span class="op">)</span></span>
<span>  <span class="va">current</span> <span class="op">&lt;-</span> <span class="va">start</span></span>
<span>  </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">n_samples</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">proposal</span> <span class="op">&lt;-</span> <span class="fu">proposal_distribution</span><span class="op">(</span><span class="va">current</span>, <span class="va">proposal_sigma</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">proposal</span> <span class="op">&gt;=</span> <span class="fl">0</span> <span class="op">&amp;&amp;</span> <span class="va">proposal</span> <span class="op">&lt;=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">acceptance_ratio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu">posterior</span><span class="op">(</span><span class="va">proposal</span><span class="op">)</span> <span class="op">/</span> <span class="fu">posterior</span><span class="op">(</span><span class="va">current</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">acceptance_ratio</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">current</span> <span class="op">&lt;-</span> <span class="va">proposal</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">samples</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">current</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">samples</span></span>
<span><span class="op">}</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Esecuzione dell’Algoritmo.</strong></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Parametri</span></span>
<span><span class="va">n_samples</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="va">start</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">proposal_sigma</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span></span>
<span><span class="co"># Esecuzione</span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu">metropolis</span><span class="op">(</span><span class="va">n_samples</span>, <span class="va">start</span>, <span class="va">proposal_sigma</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Burn-in</span></span>
<span><span class="va">burnin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="va">n_samples</span> <span class="op">*</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">post_samples</span> <span class="op">&lt;-</span> <span class="va">samples</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">burnin</span><span class="op">)</span><span class="op">]</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Analisi dei Risultati.</strong></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Media e deviazione standard</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">post_samples</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.244</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">post_samples</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.0395</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Calcolo dell’Intervallo di Credibilità al 94%.</strong></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">post_samples</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.03</span>, <span class="fl">0.97</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    3%   97% </span></span>
<span><span class="co">#&gt; 0.170 0.319</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Confronto con la Soluzione Analitica.</strong></p>
<p>La distribuzione a posteriori teorica è:</p>
<p><span class="math display">\[
\theta \sim \text{Beta}(27, 83)
\]</span></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Media teorica</span></span>
<span><span class="va">mean_beta</span> <span class="op">&lt;-</span> <span class="fl">27</span> <span class="op">/</span> <span class="op">(</span><span class="fl">27</span> <span class="op">+</span> <span class="fl">83</span><span class="op">)</span></span>
<span><span class="va">mean_beta</span></span>
<span><span class="co">#&gt; [1] 0.245</span></span>
<span></span>
<span><span class="co"># Intervallo teorico</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">qbeta</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.03</span>, <span class="fl">0.97</span><span class="op">)</span>, <span class="fl">27</span>, <span class="fl">83</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.173 0.326</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Trace Plot.</strong></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Trace plot</span></span>
<span><span class="va">post_samples</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tibble</span><span class="op">(</span>Iteration <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">post_samples</span><span class="op">)</span>, Theta <span class="op">=</span> <span class="va">post_samples</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Iteration</span>, y <span class="op">=</span> <span class="va">Theta</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Iterazione"</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="01_metropolis_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:85.0%"></p>
</figure>
</div>
</div>
</div>
<p><strong>Istogramma e Curva Teorica.</strong></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Prima generiamo il dataset della curva teorica separatamente</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">dens_teorica</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">dbeta</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">27</span>, <span class="fl">83</span><span class="op">)</span></span>
<span><span class="va">curva_teorica</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">dens_teorica</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Ora costruiamo il grafico correttamente</span></span>
<span><span class="fu">tibble</span><span class="op">(</span>Theta <span class="op">=</span> <span class="va">post_samples</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Theta</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="fu">after_stat</span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">30</span>, </span>
<span>                 color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"lightblue"</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>data <span class="op">=</span> <span class="va">curva_teorica</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, </span>
<span>            color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>, y <span class="op">=</span> <span class="st">"Densità"</span><span class="op">)</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="01_metropolis_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:85.0%"></p>
</figure>
</div>
</div>
</div>
<p><strong>Risultati Riassunti.</strong></p>
<table class="caption-top table">
<thead><tr class="header">
<th style="text-align: left;">Metodo</th>
<th style="text-align: left;">Media</th>
<th style="text-align: left;">Intervallo 94%</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">MCMC (Metropolis)</td>
<td style="text-align: left;">circa 0.245</td>
<td style="text-align: left;">circa [0.176, 0.320]</td>
</tr>
<tr class="even">
<td style="text-align: left;">Teorico Beta(27,83)</td>
<td style="text-align: left;">0.245</td>
<td style="text-align: left;">[0.177, 0.318]</td>
</tr>
</tbody>
</table>
<p><strong>Spiegazioni Didattiche Finali.</strong></p>
<div class="callout callout-style-simple callout-note no-icon callout-titled" title="Distribuzione a posteriori: interpretazione">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Distribuzione a posteriori: interpretazione
</div>
</div>
<div class="callout-body-container callout-body">
<p>La distribuzione a posteriori ci dice quanto sono plausibili i diversi valori di <span class="math inline">\(\theta\)</span> dopo aver osservato i dati.</p>
<blockquote class="blockquote">
<p>Ad esempio: “C’è una probabilità del 94% che la vera proporzione di studenti con alta autostima sia tra 17% e 32%.”</p>
</blockquote>
</div>
</div>
<div class="callout callout-style-simple callout-tip no-icon callout-titled" title="Accettare mosse peggiori: motivo">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Accettare mosse peggiori: motivo
</div>
</div>
<div class="callout-body-container callout-body">
<p>Accettiamo campioni con probabilità più bassa per permettere alla catena di esplorare anche aree meno probabili e <strong>non restare bloccata</strong> nei massimi locali.</p>
</div>
</div>
<div class="callout callout-style-simple callout-warning no-icon callout-titled" title="Larghezza della proposta: trade-off">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Larghezza della proposta: trade-off
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>
<strong>Proposta stretta</strong> (piccoli passi): alta accettazione, ma esplorazione lenta.</li>
<li>
<strong>Proposta larga</strong> (grandi passi): bassa accettazione, ma esplorazione più ampia.</li>
</ul>
<p>Si cerca un tasso di accettazione tra 40% e 50%.</p>
</div>
</div>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Diagnostica grafica">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Diagnostica grafica
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>
<strong>Trace plot</strong>: deve mostrare fluttuazioni stabili senza trend.</li>
<li>
<strong>Correlogramma</strong>: l’autocorrelazione deve decrescere rapidamente.</li>
</ul>
<p>Questi strumenti aiutano a diagnosticare una buona esplorazione della distribuzione a posteriori.</p>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-important no-icon callout-titled" title="Esercizio 2 - Depressione (BDI-II)">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Esercizio 2 - Depressione (BDI-II)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In uno studio clinico, sono stati raccolti i punteggi BDI-II (Beck Depression Inventory) di 30 pazienti. Vogliamo stimare il valore medio della depressione nella popolazione da cui provengono questi soggetti.</p>
<p>Supponiamo di avere una conoscenza a priori modellata da una distribuzione <strong>Normale(30, 5²)</strong> per la media <span class="math inline">\(\mu\)</span>.</p>
<p>I dati osservati sono i seguenti:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">26</span>, <span class="fl">35</span>, <span class="fl">30</span>, <span class="fl">25</span>, <span class="fl">44</span>, <span class="fl">30</span>, <span class="fl">33</span>, <span class="fl">43</span>, <span class="fl">22</span>, <span class="fl">43</span>,</span>
<span>       <span class="fl">24</span>, <span class="fl">19</span>, <span class="fl">39</span>, <span class="fl">31</span>, <span class="fl">25</span>, <span class="fl">28</span>, <span class="fl">35</span>, <span class="fl">30</span>, <span class="fl">26</span>, <span class="fl">31</span>,</span>
<span>       <span class="fl">41</span>, <span class="fl">36</span>, <span class="fl">26</span>, <span class="fl">35</span>, <span class="fl">33</span>, <span class="fl">28</span>, <span class="fl">27</span>, <span class="fl">34</span>, <span class="fl">27</span>, <span class="fl">22</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>  </span>
<span><span class="co">#&gt; [1] 30</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Funzioni a priori, verosimiglianza e posteriori.</strong></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Prior: Normal(30, 5^2)</span></span>
<span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mu</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">mu</span>, mean <span class="op">=</span> <span class="fl">30</span>, sd <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Likelihood: Normal(mu, sigma^2), sigma stimato dai dati</span></span>
<span><span class="va">likelihood</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mu</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">data</span>, mean <span class="op">=</span> <span class="va">mu</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Posterior non normalizzata</span></span>
<span><span class="va">posterior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mu</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">likelihood</span><span class="op">(</span><span class="va">mu</span>, <span class="va">data</span><span class="op">)</span> <span class="op">*</span> <span class="fu">prior</span><span class="op">(</span><span class="va">mu</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Algoritmo di Metropolis.</strong></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">metropolis_for_normal</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">nsamp</span>, <span class="va">xinit</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="va">nsamp</span><span class="op">)</span></span>
<span>  <span class="va">x_prev</span> <span class="op">&lt;-</span> <span class="va">xinit</span></span>
<span>  </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">nsamp</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x_star</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="va">x_prev</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>  <span class="co"># proposta</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu">posterior</span><span class="op">(</span><span class="va">x_star</span>, <span class="va">data</span><span class="op">)</span> <span class="op">/</span> <span class="fu">posterior</span><span class="op">(</span><span class="va">x_prev</span>, <span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">x_prev</span> <span class="op">&lt;-</span> <span class="va">x_star</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">samples</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x_prev</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">samples</span></span>
<span><span class="op">}</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Esecuzione dell’algoritmo.</strong></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu">metropolis_for_normal</span><span class="op">(</span><span class="fl">100000</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="va">burnin</span> <span class="op">&lt;-</span> <span class="fl">50000</span></span>
<span><span class="va">post_samples</span> <span class="op">&lt;-</span> <span class="va">samples</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">burnin</span><span class="op">)</span><span class="op">]</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Confronto con la soluzione analitica.</strong></p>
<p>Nel caso prior Normale e likelihood Normale con varianza nota, la posterior è ancora Normale:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Prior</span></span>
<span><span class="va">mu_prior</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span><span class="va">std_prior</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">var_prior</span> <span class="op">&lt;-</span> <span class="va">std_prior</span><span class="op">^</span><span class="fl">2</span></span>
<span></span>
<span><span class="co"># Likelihood</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">sum_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">var_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mu_post</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">mu_prior</span> <span class="op">/</span> <span class="va">var_prior</span> <span class="op">+</span> <span class="va">sum_y</span> <span class="op">/</span> <span class="va">var_data</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">var_prior</span> <span class="op">+</span> <span class="va">n</span> <span class="op">/</span> <span class="va">var_data</span><span class="op">)</span></span>
<span><span class="va">var_post</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">var_prior</span> <span class="op">+</span> <span class="va">n</span> <span class="op">/</span> <span class="va">var_data</span><span class="op">)</span></span>
<span><span class="va">std_post</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var_post</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">mu_post</span>, <span class="va">std_post</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 30.88  1.17</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Trace Plot.</strong></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Trace plot</span></span>
<span><span class="va">post_samples</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tibble</span><span class="op">(</span>Iteration <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">post_samples</span><span class="op">)</span>, Mu <span class="op">=</span> <span class="va">post_samples</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Iteration</span>, y <span class="op">=</span> <span class="va">Mu</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Iterazione"</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="01_metropolis_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:85.0%"></p>
</figure>
</div>
</div>
</div>
<p><strong>Istogramma vs Posterior Analitica.</strong></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">mu_post</span> <span class="op">-</span> <span class="fl">4</span> <span class="op">*</span> <span class="va">std_post</span>, <span class="va">mu_post</span> <span class="op">+</span> <span class="fl">4</span> <span class="op">*</span> <span class="va">std_post</span>, length.out <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">dens_teorica</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">x</span>, mean <span class="op">=</span> <span class="va">mu_post</span>, sd <span class="op">=</span> <span class="va">std_post</span><span class="op">)</span></span>
<span><span class="va">curva_teorica</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">dens_teorica</span><span class="op">)</span></span>
<span></span>
<span><span class="va">post_samples</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tibble</span><span class="op">(</span>Mu <span class="op">=</span> <span class="va">post_samples</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Mu</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="fu">after_stat</span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">30</span>, fill <span class="op">=</span> <span class="st">"skyblue"</span>, color <span class="op">=</span> <span class="st">"black"</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>data <span class="op">=</span> <span class="va">curva_teorica</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span>, y <span class="op">=</span> <span class="st">"Densit\u00e0"</span><span class="op">)</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="01_metropolis_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:85.0%"></p>
</figure>
</div>
</div>
</div>
<p><strong>Cosa significa la distribuzione a posteriori?</strong></p>
<p>In termini concreti, la distribuzione a posteriori rappresenta la nostra incertezza residua sul valore di <span class="math inline">\(\mu\)</span>, la media dei punteggi BDI-II nella popolazione, <strong>dopo aver visto i dati</strong>. Per esempio, se calcoliamo che il 94% della distribuzione a posteriori cade tra 27.5 e 32.3, possiamo dire:</p>
<blockquote class="blockquote">
<p>“Date le nostre ipotesi iniziali e i dati osservati, c’è una probabilità del 94% che il vero valore medio della depressione nella popolazione stia tra 27.5 e 32.3”.</p>
</blockquote>
<p>Questa è una <strong>affermazione probabilistica sul parametro</strong>, che è una caratteristica distintiva dell’inferenza bayesiana.</p>
<p>Questa distribuzione combina:</p>
<ul>
<li>le credenze precedenti (il prior),</li>
<li>con l’evidenza osservata (i dati).</li>
</ul>
<p>Il risultato è una distribuzione che riflette cosa sappiamo del parametro dopo aver osservato i dati, e può essere usata per ottenere medie, intervalli di credibilità, probabilità soggettive, ecc.</p>
<div class="callout callout-style-simple callout-tip no-icon callout-titled" title="Perché accettare anche campioni con densità più bassa?">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Perché accettare anche campioni con densità più bassa?
</div>
</div>
<div class="callout-body-container callout-body">
<p>Nell’algoritmo di Metropolis, a ogni passo si propone un nuovo valore di <span class="math inline">\(\theta\)</span>. Se questo valore ha una densità a posteriori più alta, viene accettato.</p>
<p>Ma se ha una densità più bassa, viene comunque accettato con una certa probabilità.</p>
<p><strong>Perché farlo?</strong></p>
<p>Per evitare che la catena si “blocchi” in un massimo locale. Per esplorare anche le aree meno probabili, ma comunque possibili, della distribuzione.</p>
<p>È un meccanismo simile a quello con cui gli esseri umani esplorano: ogni tanto vale la pena provare strade meno promettenti, per evitare di restare intrappolati. Accettare “mosse peggiori” è quindi un meccanismo di esplorazione utile a garantire che la catena possa visitare l’intero spazio dei parametri e convergere correttamente alla distribuzione desiderata.</p>
</div>
</div>
<div class="callout callout-style-simple callout-warning no-icon callout-titled" title="Larghezza della proposta: un equilibrio delicato">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Larghezza della proposta: un equilibrio delicato
</div>
</div>
<div class="callout-body-container callout-body">
<p>Nel Metropolis, il nuovo valore proposto viene scelto spostandosi dal valore corrente secondo una distribuzione normale:</p>
<p><span class="math display">\[\theta_{new} \sim \mathcal{N}(\theta_{attuale}, \sigma).\]</span></p>
<p>Il parametro <span class="math inline">\(\sigma\)</span> controlla la distanza dei passi.</p>
<p>Se <span class="math inline">\(\sigma\)</span> è:</p>
<ul>
<li>Piccolo → i passi sono molto corti:
<ul>
<li>Molte proposte vengono accettate (alta accettazione),</li>
<li>Ma la catena esplora lentamente → i campioni sono fortemente autocorrelati.</li>
</ul>
</li>
<li>Grande → i passi sono molto lunghi:
<ul>
<li>Si propongono salti drastici → molte proposte vengono rifiutate,</li>
<li>La catena si muove poco → anche in questo caso, esplorazione inefficiente.</li>
</ul>
</li>
</ul>
<p>Obiettivo: trovare un compromesso ottimale.</p>
<ul>
<li>Per un parametro unidimensionale, si consiglia spesso un tasso di accettazione tra 40% e 50%.</li>
<li>Negli esercizi puoi provare diversi valori di proposal_sigma e osservare il tasso di accettazione per imparare.</li>
</ul>
</div>
</div>
<p><strong>Risultati.</strong></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">post_samples</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 30.9</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">post_samples</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.15</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">post_samples</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.03</span>, <span class="fl">0.97</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   3%  97% </span></span>
<span><span class="co">#&gt; 28.7 33.1</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Valori teorici:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mu_post</span>  <span class="co"># media teorica</span></span>
<span><span class="co">#&gt; [1] 30.9</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.03</span>, <span class="fl">0.97</span><span class="op">)</span>, mean <span class="op">=</span> <span class="va">mu_post</span>, sd <span class="op">=</span> <span class="va">std_post</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 28.7 33.1</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Spiegazione Didattica.</strong></p>
<ul>
<li>La media <span class="math inline">\(\mu\)</span> rappresenta il livello medio di depressione nella popolazione.</li>
<li>Il prior rappresenta la nostra credenza iniziale (Normale con media 30).</li>
<li>L’evidenza fornita dai dati modifica questa credenza.</li>
<li>L’algoritmo di Metropolis permette di campionare da una distribuzione posterior anche senza conoscere la forma analitica.</li>
<li>Il confronto tra distribuzione teorica e campioni MCMC mostra un ottimo accordo.</li>
</ul>
<p><strong>Conclusione.</strong></p>
<p>In questo esercizio abbiamo:</p>
<ul>
<li>implementato l’algoritmo di Metropolis per un caso con prior e likelihood Normali;</li>
<li>stimato la media della distribuzione posterior;</li>
<li>confrontato i risultati con la soluzione analitica;</li>
<li>verificato la coerenza dei campioni MCMC con la distribuzione teorica.</li>
</ul>
<p>Questo mostra la potenza dell’approccio MCMC anche in situazioni dove la soluzione analitica sarebbe disponibile, e pone le basi per affrontare problemi più complessi.</p>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note no-icon callout-titled" title="Informazioni sull'ambiente di sviluppo">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Informazioni sull’ambiente di sviluppo
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.1 (2025-06-13)</span></span>
<span><span class="co">#&gt; Platform: aarch64-apple-darwin20</span></span>
<span><span class="co">#&gt; Running under: macOS Sequoia 15.6.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRblas.0.dylib </span></span>
<span><span class="co">#&gt; LAPACK: /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt; [1] C/UTF-8/C/C/C/C</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: Europe/Rome</span></span>
<span><span class="co">#&gt; tzcode source: internal</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt;  [1] reshape2_1.4.4        cmdstanr_0.9.0        pillar_1.11.0        </span></span>
<span><span class="co">#&gt;  [4] tinytable_0.13.0      patchwork_1.3.2       ggdist_3.3.3         </span></span>
<span><span class="co">#&gt;  [7] tidybayes_3.0.7       bayesplot_1.14.0      ggplot2_3.5.2        </span></span>
<span><span class="co">#&gt; [10] reliabilitydiag_0.2.1 priorsense_1.1.1      posterior_1.6.1      </span></span>
<span><span class="co">#&gt; [13] loo_2.8.0             rstan_2.32.7          StanHeaders_2.32.10  </span></span>
<span><span class="co">#&gt; [16] brms_2.22.0           Rcpp_1.1.0            sessioninfo_1.2.3    </span></span>
<span><span class="co">#&gt; [19] conflicted_1.2.0      janitor_2.2.1         matrixStats_1.5.0    </span></span>
<span><span class="co">#&gt; [22] modelr_0.1.11         tibble_3.3.0          dplyr_1.1.4          </span></span>
<span><span class="co">#&gt; [25] tidyr_1.3.1           rio_1.2.3             here_1.0.1           </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] gridExtra_2.3         inline_0.3.21         sandwich_3.1-1       </span></span>
<span><span class="co">#&gt;  [4] rlang_1.1.6           magrittr_2.0.3        multcomp_1.4-28      </span></span>
<span><span class="co">#&gt;  [7] snakecase_0.11.1      compiler_4.5.1        systemfonts_1.2.3    </span></span>
<span><span class="co">#&gt; [10] vctrs_0.6.5           stringr_1.5.1         pkgconfig_2.0.3      </span></span>
<span><span class="co">#&gt; [13] arrayhelpers_1.1-0    fastmap_1.2.0         backports_1.5.0      </span></span>
<span><span class="co">#&gt; [16] labeling_0.4.3        rmarkdown_2.29        ps_1.9.1             </span></span>
<span><span class="co">#&gt; [19] ragg_1.5.0            purrr_1.1.0           xfun_0.53            </span></span>
<span><span class="co">#&gt; [22] cachem_1.1.0          jsonlite_2.0.0        broom_1.0.9          </span></span>
<span><span class="co">#&gt; [25] parallel_4.5.1        R6_2.6.1              stringi_1.8.7        </span></span>
<span><span class="co">#&gt; [28] RColorBrewer_1.1-3    lubridate_1.9.4       estimability_1.5.1   </span></span>
<span><span class="co">#&gt; [31] knitr_1.50            zoo_1.8-14            R.utils_2.13.0       </span></span>
<span><span class="co">#&gt; [34] pacman_0.5.1          Matrix_1.7-4          splines_4.5.1        </span></span>
<span><span class="co">#&gt; [37] timechange_0.3.0      tidyselect_1.2.1      abind_1.4-8          </span></span>
<span><span class="co">#&gt; [40] yaml_2.3.10           codetools_0.2-20      curl_7.0.0           </span></span>
<span><span class="co">#&gt; [43] processx_3.8.6        pkgbuild_1.4.8        lattice_0.22-7       </span></span>
<span><span class="co">#&gt; [46] plyr_1.8.9            withr_3.0.2           bridgesampling_1.1-2 </span></span>
<span><span class="co">#&gt; [49] coda_0.19-4.1         evaluate_1.0.5        survival_3.8-3       </span></span>
<span><span class="co">#&gt; [52] RcppParallel_5.1.11-1 tensorA_0.36.2.1      checkmate_2.3.3      </span></span>
<span><span class="co">#&gt; [55] stats4_4.5.1          distributional_0.5.0  generics_0.1.4       </span></span>
<span><span class="co">#&gt; [58] rprojroot_2.1.1       rstantools_2.5.0      scales_1.4.0         </span></span>
<span><span class="co">#&gt; [61] xtable_1.8-4          glue_1.8.0            emmeans_1.11.2-8     </span></span>
<span><span class="co">#&gt; [64] tools_4.5.1           data.table_1.17.8     mvtnorm_1.3-3        </span></span>
<span><span class="co">#&gt; [67] grid_4.5.1            QuickJSR_1.8.0        colorspace_2.1-1     </span></span>
<span><span class="co">#&gt; [70] nlme_3.1-168          cli_3.6.5             textshaping_1.0.3    </span></span>
<span><span class="co">#&gt; [73] svUnit_1.0.8          Brobdingnag_1.2-9     V8_7.0.0             </span></span>
<span><span class="co">#&gt; [76] gtable_0.3.6          R.methodsS3_1.8.2     digest_0.6.37        </span></span>
<span><span class="co">#&gt; [79] TH.data_1.1-4         htmlwidgets_1.6.4     farver_2.1.2         </span></span>
<span><span class="co">#&gt; [82] R.oo_1.27.1           memoise_2.0.1         htmltools_0.5.8.1    </span></span>
<span><span class="co">#&gt; [85] lifecycle_1.0.4       MASS_7.3-65</span></span></code><button title="Copia negli appunti" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section><section id="bibliografia" class="level2 unnumbered unlisted"><h2 class="unnumbered unlisted anchored" data-anchor-id="bibliografia">Bibliografia</h2>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-buerkner2024brms" class="csl-entry" role="listitem">
Bürkner, P.-C. (2024). <em>The brms Book: Applied Bayesian Regression Modelling Using R and Stan (Early Draft)</em>. <a href="https://paulbuerkner.com/software/brms-book">https://paulbuerkner.com/software/brms-book</a>
</div>
<div id="ref-duane1987hybrid" class="csl-entry" role="listitem">
Duane, S., Kennedy, A. D., Pendleton, B. J., &amp; Roweth, D. (1987). Hybrid monte carlo. <em>Physics letters B</em>, <em>195</em>(2), 216–222.
</div>
<div id="ref-geman_geman_1984" class="csl-entry" role="listitem">
Geman, S., &amp; Geman, D. (1984). Stochastic relaxation, <span>Gibbs</span> distributions, and the <span>Bayesian</span> restoration of images. <em>IEEE Transactions on pattern analysis and machine intelligence</em>, <em>6</em>, 721–741.
</div>
<div id="ref-hanada2022mcmc" class="csl-entry" role="listitem">
Hanada, M., &amp; Matsuura, S. (2022). <em>MCMC from Scratch</em>. Springer.
</div>
<div id="ref-hastings_1970" class="csl-entry" role="listitem">
Hastings, W. K. (1970). <span>Monte</span> <span>Carlo</span> sampling methods using <span>Markov</span> chains and their applications. <em>Biometrika</em>, <em>57</em>(1), 97–109.
</div>
<div id="ref-hoffman2014no" class="csl-entry" role="listitem">
Hoffman, M. D., Gelman, A., et al. (2014). The No-U-Turn sampler: adaptively setting path lengths in Hamiltonian Monte Carlo. <em>Journal of Machine Learning Research</em>, <em>15</em>(1), 1593–1623.
</div>
<div id="ref-metropolist_etal_1953" class="csl-entry" role="listitem">
Metropolis, N., Rosenbluth, A. W., Rosenbluth, M. N., Teller, A. H., &amp; Teller, E. (1953). Equation of state calculations by fast computing machines. <em>The Journal of Chemical Physics</em>, <em>21</em>(6), 1087–1092.
</div>
<div id="ref-zetsche_2019future" class="csl-entry" role="listitem">
Zetsche, U., Buerkner, P.-C., &amp; Renneberg, B. (2019). Future expectations in clinical depression: biased or realistic? <em>Journal of Abnormal Psychology</em>, <em>128</em>(7), 678–688.
</div>
</div>
</section></main><!-- /main --><script>
document.body.classList.add('classic-book');
document.addEventListener('DOMContentLoaded', function() {
  const paragraphs = document.querySelectorAll('p');
  paragraphs.forEach(p => {
    if (p.textContent.length > 200) {
      p.style.hyphens = 'auto';
      p.style.hyphenateCharacter = '-';
    }
  });
  const headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6');
  headings.forEach(h => {
    h.style.fontFeatureSettings = '"liga" 1, "dlig" 1, "smcp" 1';
  });
});
</script><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copiato!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copiato!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/ccaudek\.github\.io\/psicometria-r\/intro\.html");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../../chapters/mcmc/introduction_mcmc.html" class="pagination-link" aria-label="Introduzione">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Introduzione</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/mcmc/02_ppl.html" class="pagination-link" aria-label="Linguaggi di programmazione probabilistici">
        <span class="nav-page-text"><span class="chapter-number">49</span>&nbsp; <span class="chapter-title">Linguaggi di programmazione probabilistici</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p><strong>Psicometria</strong> è una risorsa didattica creata per il corso di Scienze e Tecniche Psicologiche dell’Università degli Studi di Firenze.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ccaudek/psicometria-r/blob/main/chapters/mcmc/01_metropolis.qmd" class="toc-action"><i class="bi bi-github"></i>Mostra il codice</a></li><li><a href="https://github.com/ccaudek/psicometria-r/issues/new" class="toc-action"><i class="bi empty"></i>Segnala un problema</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Realizzato con <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>